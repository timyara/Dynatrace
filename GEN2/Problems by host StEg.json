{"version":11,"variables":[{"key":"Hosts","type":"query","input":"fetch dt.entity.host\n| fields entity.name\n| sort entity.name asc\n| summarize HostNames = collectDistinct(entity.name)","multiple":true}],"tiles":{"0":{"type":"data","title":"","query":"fetch events\n| filter event.kind == \"DAVIS_PROBLEM\"\n// affected_entity_ids is an array of IDs. Needs to be expanded to filter for hosts\n| expand affected_entity_ids\n| fieldsAdd hostEntity = lookup([fetch dt.entity.host | filter in(entity.name, array($Hosts))], sourceField:affected_entity_ids, lookupField:id)\n// only retain records where the host entity lookup matches\n| filter isNotNull(hostEntity[id]) \n\n// DAVIS_PROBLEM events are snapshot, see https://www.dynatrace.com/support/help/shortlink/davis-dql-examples\n// sort to get the latest snapshot, summarize to take data from the latest snapshot per problem/host combination\n| sort timestamp desc\n| summarize {\n    lastProblemUpdate = takeFirst(timestamp), \n    host.name = takeFirst(hostEntity[entity.name])\n    }, by:{problemId = display_id, dt.entity.host = hostEntity[id]}","visualization":"table","visualizationSettings":{"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"absolute"}},"singleValue":{"showLabel":true,"label":"","autoscale":true},"table":{"rowDensity":"condensed","enableLineWrap":true,"enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[["dt.entity.process_group_instance.name"]],"columnWidths":{}}}},"1":{"type":"data","title":"","query":"/*fetch events\n| sort event.category\n| filter event.kind == \"DAVIS_PROBLEM\"\n| lookup \n//[\n*/\nfetch dt.entity.host\n| filter in(entity.name, array($Hosts))\n//], sourceField:affected_entiti\n","visualization":"table","visualizationSettings":{"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"absolute"}},"singleValue":{"showLabel":true,"label":"","autoscale":true},"table":{"rowDensity":"condensed","enableLineWrap":true,"enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}}}},"2":{"type":"markdown","title":"","content":"$Hosts"}},"layouts":{"0":{"x":0,"y":0,"w":23,"h":6},"1":{"x":0,"y":6,"w":22,"h":5},"2":{"x":0,"y":11,"w":8,"h":6}}}