{"version":"5","defaultTimeframe":{"from":"now-2h","to":"now"},"sections":[{"id":"7752dd60-c01a-4738-9a4d-3699b0f9a2ce","type":"markdown","markdown":"# Davis DQL examples\nThese examples help illustrate how to build powerful and flexible health dashboards by using DQL to slice and dice all Davis reported problems and events.\n\nYou can also find a [opinionated final version of a dashboard](https://wkf10640.apps.dynatrace.com/ui/apps/dynatrace.dashboards/dashboard/3126a47f-a09c-4738-a59a-aba10dd53f19#from=now-7d&to=now&vfilter_Status=CLOSED&vfilter_Severity=ALL) based on Davis problems.\n\nInterested in learning more? [Have a closer look at our documentation](https://docs.dynatrace.com/docs/platform/davis-ai/davis-dql-examples) and explore [eight examples](https://docs.dynatrace.com/docs/platform/davis-ai/davis-dql-examples) on what you can do with Davis events. "},{"id":"92816cbe-5386-4d5e-a0a0-d38a61dc307f","type":"markdown","markdown":"### Example 1\nCount the total number of problems in the last 24 hours.\n\n**Note:** why does this count differ from the count on the dashboard referenced above? It differs because this is the raw count of all Davis problem events, including updates to existing events.\nIn case you want unique events please use the opinionated dashboard instead.  "},{"id":"bb75cfe6-21ae-4e3c-8e58-da80455d8012","type":"dql","showTitle":false,"state":{"input":{"value":"fetch events, from:now()-7d, to:now()\n| filter event.kind == \"DAVIS_PROBLEM\"\n| summarize {problemCount = countDistinct(event.id)}","timeframe":{"from":"now-2h","to":"now"}},"state":"success","davis":{"includeLogs":true,"isDavisVisualizationAvailable":true},"visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"absolute"},"categoryOverrides":{}},"singleValue":{"label":"","prefixIcon":"WarningIcon","autoscale":true,"sparklineSettings":{"isVisible":false},"alignment":"center"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"firstVisibleRowIndex":0,"columnWidths":{}}},"result":{"code":200,"value":{"records":[{"problemCount":"57"}],"metadata":{"grail":{"canonicalQuery":"fetch events, from:now() - 7d, to:now()\n| filter event.kind == \"DAVIS_PROBLEM\"\n| summarize countDistinct(event.id), alias:problemCount","timezone":"Europe/Vienna","query":"fetch events, from:now()-7d, to:now()\n| filter event.kind == \"DAVIS_PROBLEM\"\n| summarize {problemCount = countDistinct(event.id)}","scannedRecords":105244,"dqlVersion":"V1_0","scannedBytes":45671283,"analysisTimeframe":{"start":"2023-10-17T06:36:34.975Z","end":"2023-10-24T06:36:34.975Z"},"locale":"","executionTimeMilliseconds":33,"notifications":[],"queryId":"6077cfa4-1ccc-454d-bb2d-318381e2f4ba","sampled":false}},"types":[{"mappings":{"problemCount":{"type":"long"}},"indexRange":[0,0]}]},"notifications":[],"dateTime":"2023-10-24T06:36:34.858Z","input":{"value":"fetch events, from:now()-7d, to:now()\n| filter event.kind == \"DAVIS_PROBLEM\"\n| summarize {problemCount = countDistinct(event.id)}","timeframe":{"from":"now-2h","to":"now"}}},"visualization":"singleValue"},"height":450},{"id":"f6990372-4c85-44d0-a643-f51efae1567e","type":"markdown","markdown":"### Example 2 \nCount the current number of active problems."},{"id":"8782789f-d782-4f0c-939d-69a6f36d8b30","type":"dql","showTitle":false,"state":{"input":{"value":"fetch events\n| filter event.kind == \"DAVIS_PROBLEM\"\n| sort timestamp, direction:\"ascending\"\n| summarize {event.status = takeLast(event.status)}, by:{ event.id }\n| filter event.status == \"ACTIVE\"\n| summarize {activeEvents = countDistinct(event.id)}","timeframe":{"from":"now-2h","to":"now"}},"state":"success","davis":{"includeLogs":true,"isDavisVisualizationAvailable":true},"visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"absolute"},"categoryOverrides":{}},"singleValue":{"label":"","prefixIcon":"","autoscale":true,"alignment":"center"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"firstVisibleRowIndex":0,"columnWidths":{}}},"result":{"code":200,"value":{"records":[{"activeEvents":"0"}],"metadata":{"grail":{"canonicalQuery":"fetch events\n| filter event.kind == \"DAVIS_PROBLEM\"\n| sort timestamp, direction:\"ascending\"\n| summarize by:{event.id}, takeLast(event.status), alias:event.status\n| filter event.status == \"ACTIVE\"\n| summarize countDistinct(event.id), alias:activeEvents","timezone":"Europe/Vienna","query":"fetch events\n| filter event.kind == \"DAVIS_PROBLEM\"\n| sort timestamp, direction:\"ascending\"\n| summarize {event.status = takeLast(event.status)}, by:{ event.id }\n| filter event.status == \"ACTIVE\"\n| summarize {activeEvents = countDistinct(event.id)}","scannedRecords":2515,"dqlVersion":"V1_0","scannedBytes":671138,"analysisTimeframe":{"start":"2023-10-23T17:02:45.682Z","end":"2023-10-23T19:02:45.682Z"},"locale":"","executionTimeMilliseconds":26,"notifications":[],"queryId":"235bf2f8-2930-4366-938a-c57fdb150f59","sampled":false}},"types":[{"mappings":{"activeEvents":{"type":"long"}},"indexRange":[0,0]}]},"notifications":[],"dateTime":"2023-10-23T19:02:45.681Z","input":{"value":"fetch events\n| filter event.kind == \"DAVIS_PROBLEM\"\n| sort timestamp, direction:\"ascending\"\n| summarize {event.status = takeLast(event.status)}, by:{ event.id }\n| filter event.status == \"ACTIVE\"\n| summarize {activeEvents = countDistinct(event.id)}","timeframe":{"from":"now-2h","to":"now"}}},"visualization":"singleValue"},"height":450},{"id":"e7649da0-dbe0-40e4-9e74-a2803c62913b","type":"markdown","markdown":"### Example 3\nChart the number of problems in the last 7 days to identify a trend within your environment stability."},{"id":"4ca0896c-ec2c-4a30-af37-652d31f14982","type":"dql","showTitle":false,"state":{"input":{"value":"fetch events, from:now()-7d, to:now()\n| filter event.kind == \"DAVIS_PROBLEM\"\n| summarize count = count(), by: {`60m interval` = bin(timestamp, 60m)}","timeframe":{"from":"now-2h","to":"now"}},"state":"success","davis":{"includeLogs":true,"isDavisVisualizationAvailable":true},"visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"absolute"},"categoryOverrides":{},"colorPalette":"fireplace"},"singleValue":{"label":"","prefixIcon":"","autoscale":true,"alignment":"center"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"firstVisibleRowIndex":0,"columnWidths":{}}},"result":{"code":200,"value":{"records":[{"60m interval":"2023-10-16T21:00:00.000000000+02:00","count":"3"},{"60m interval":"2023-10-16T22:00:00.000000000+02:00","count":"67"},{"60m interval":"2023-10-17T20:00:00.000000000+02:00","count":"47"},{"60m interval":"2023-10-17T21:00:00.000000000+02:00","count":"3"},{"60m interval":"2023-10-17T22:00:00.000000000+02:00","count":"62"},{"60m interval":"2023-10-18T20:00:00.000000000+02:00","count":"50"},{"60m interval":"2023-10-18T21:00:00.000000000+02:00","count":"3"},{"60m interval":"2023-10-18T22:00:00.000000000+02:00","count":"68"},{"60m interval":"2023-10-19T20:00:00.000000000+02:00","count":"65"},{"60m interval":"2023-10-19T21:00:00.000000000+02:00","count":"3"},{"60m interval":"2023-10-19T22:00:00.000000000+02:00","count":"72"},{"60m interval":"2023-10-20T10:00:00.000000000+02:00","count":"12"},{"60m interval":"2023-10-20T11:00:00.000000000+02:00","count":"27"},{"60m interval":"2023-10-20T12:00:00.000000000+02:00","count":"11"},{"60m interval":"2023-10-20T13:00:00.000000000+02:00","count":"12"},{"60m interval":"2023-10-20T14:00:00.000000000+02:00","count":"8"},{"60m interval":"2023-10-20T15:00:00.000000000+02:00","count":"24"},{"60m interval":"2023-10-20T17:00:00.000000000+02:00","count":"2"},{"60m interval":"2023-10-20T18:00:00.000000000+02:00","count":"9"},{"60m interval":"2023-10-20T19:00:00.000000000+02:00","count":"15"},{"60m interval":"2023-10-20T20:00:00.000000000+02:00","count":"63"},{"60m interval":"2023-10-20T21:00:00.000000000+02:00","count":"6"},{"60m interval":"2023-10-20T22:00:00.000000000+02:00","count":"72"},{"60m interval":"2023-10-21T01:00:00.000000000+02:00","count":"5"},{"60m interval":"2023-10-21T02:00:00.000000000+02:00","count":"1"},{"60m interval":"2023-10-21T20:00:00.000000000+02:00","count":"54"},{"60m interval":"2023-10-21T21:00:00.000000000+02:00","count":"3"},{"60m interval":"2023-10-21T22:00:00.000000000+02:00","count":"74"},{"60m interval":"2023-10-22T14:00:00.000000000+02:00","count":"6"},{"60m interval":"2023-10-22T15:00:00.000000000+02:00","count":"1"},{"60m interval":"2023-10-22T20:00:00.000000000+02:00","count":"44"},{"60m interval":"2023-10-22T21:00:00.000000000+02:00","count":"3"},{"60m interval":"2023-10-22T22:00:00.000000000+02:00","count":"78"},{"60m interval":"2023-10-23T15:00:00.000000000+02:00","count":"6"},{"60m interval":"2023-10-23T16:00:00.000000000+02:00","count":"1"},{"60m interval":"2023-10-23T20:00:00.000000000+02:00","count":"64"}],"metadata":{"grail":{"canonicalQuery":"fetch events, from:now() - 7d, to:now()\n| filter event.kind == \"DAVIS_PROBLEM\"\n| summarize by:{bin(timestamp, 60m), alias:`60m interval`}, count(), alias:count","timezone":"Europe/Vienna","query":"fetch events, from:now()-7d, to:now()\n| filter event.kind == \"DAVIS_PROBLEM\"\n| summarize count = count(), by: {`60m interval` = bin(timestamp, 60m)}","scannedRecords":105727,"dqlVersion":"V1_0","scannedBytes":45609618,"analysisTimeframe":{"start":"2023-10-16T19:04:59.942Z","end":"2023-10-23T19:04:59.942Z"},"locale":"","executionTimeMilliseconds":37,"notifications":[],"queryId":"4edef673-0734-4d66-a457-ec9e3360c8e3","sampled":false}},"types":[{"mappings":{"60m interval":{"type":"timestamp"},"count":{"type":"long"}},"indexRange":[0,35]}]},"notifications":[],"dateTime":"2023-10-23T19:04:59.733Z","input":{"value":"fetch events, from:now()-7d, to:now()\n| filter event.kind == \"DAVIS_PROBLEM\"\n| summarize count = count(), by: {`60m interval` = bin(timestamp, 60m)}","timeframe":{"from":"now-2h","to":"now"}}},"visualization":"barChart"},"height":450},{"id":"adb8883b-023f-4d24-8aaf-9f6e12044d24","type":"markdown","markdown":"### Example 4\nIdentify the top 10 most problem affected entities within your environment."},{"id":"d9afcb51-52a8-449d-87c3-2de187738052","type":"dql","showTitle":false,"state":{"input":{"value":"fetch events\n| filter event.kind == \"DAVIS_PROBLEM\"\n| expand affected_entity_ids\n| summarize by:{affected_entity_ids}, count = countDistinct(display_id)\n| sort count, direction:\"descending\"\n| limit 10","timeframe":{"from":"now-2h","to":"now"}},"state":"success","davis":{"includeLogs":true,"isDavisVisualizationAvailable":true},"visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"absolute"},"categoryOverrides":{}},"singleValue":{"label":"","prefixIcon":"","autoscale":true,"alignment":"center"},"table":{"rowDensity":"condensed","enableLineWrap":true,"enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"firstVisibleRowIndex":0,"columnWidths":{}}},"result":{"code":200,"value":{"records":[{"affected_entity_ids":"SERVICE-41A4F03120E830E8","count":"3"},{"affected_entity_ids":"SERVICE-9E03EFC879357717","count":"3"},{"affected_entity_ids":"SERVICE-8BACD834F8B0945E","count":"2"}],"metadata":{"grail":{"canonicalQuery":"fetch events\n| filter event.kind == \"DAVIS_PROBLEM\"\n| expand affected_entity_ids\n| summarize by:{affected_entity_ids}, countDistinct(display_id), alias:count\n| sort count, direction:\"descending\"\n| limit 10","timezone":"Europe/Vienna","query":"fetch events\n| filter event.kind == \"DAVIS_PROBLEM\"\n| expand affected_entity_ids\n| summarize by:{affected_entity_ids}, count = countDistinct(display_id)\n| sort count, direction:\"descending\"\n| limit 10","scannedRecords":2601,"dqlVersion":"V1_0","scannedBytes":675064,"analysisTimeframe":{"start":"2023-10-23T17:06:19.823Z","end":"2023-10-23T19:06:19.823Z"},"locale":"","executionTimeMilliseconds":30,"notifications":[],"queryId":"69ff1ac4-35ba-42ff-ba57-fbd4eb2a0440","sampled":false}},"types":[{"mappings":{"affected_entity_ids":{"type":"string"},"count":{"type":"long"}},"indexRange":[0,2]}]},"notifications":[],"dateTime":"2023-10-23T19:06:19.822Z","input":{"value":"fetch events\n| filter event.kind == \"DAVIS_PROBLEM\"\n| expand affected_entity_ids\n| summarize by:{affected_entity_ids}, count = countDistinct(display_id)\n| sort count, direction:\"descending\"\n| limit 10","timeframe":{"from":"now-2h","to":"now"}}},"visualization":"table"},"height":353},{"id":"0c4c5274-6b24-48b2-9f4b-d98ed521b6c2","type":"markdown","markdown":"### Example 5\nFetch all problems for a host with name \"myhost\"."},{"id":"e0e7eabc-4037-463a-a152-15137631263c","type":"dql","showTitle":false,"state":{"input":{"value":"fetch events\n| filter event.kind == \"DAVIS_PROBLEM\"\n| expand affected_entity_ids\n| lookup sourceField:affected_entity_ids, lookupField:id, prefix:\"host.\", [\nfetch dt.entity.host | fields id, name = entity.name\n]\n| filter host.name == \"myhost\"\n| limit 3","timeframe":{"from":"now-2h","to":"now"}},"state":"success","davis":{"includeLogs":true,"isDavisVisualizationAvailable":true},"visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"absolute"},"categoryOverrides":{}},"singleValue":{"label":"","prefixIcon":"","autoscale":true,"alignment":"center"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"firstVisibleRowIndex":0,"columnWidths":{}}},"result":{"code":200,"value":{"records":[],"metadata":{"grail":{"canonicalQuery":"fetch events\n| filter event.kind == \"DAVIS_PROBLEM\"\n| expand affected_entity_ids\n| lookup \n\t[\n\t\tfetch dt.entity.host\n\t\t| fields id, {entity.name, alias:name}\n\t], sourceField:affected_entity_ids, lookupField:id, prefix:\"host.\"\n| filter host.name == \"myhost\"\n| limit 3","timezone":"Europe/Vienna","query":"fetch events\n| filter event.kind == \"DAVIS_PROBLEM\"\n| expand affected_entity_ids\n| lookup sourceField:affected_entity_ids, lookupField:id, prefix:\"host.\", [\nfetch dt.entity.host | fields id, name = entity.name\n]\n| filter host.name == \"myhost\"\n| limit 3","scannedRecords":2619,"dqlVersion":"V1_0","scannedBytes":676829,"analysisTimeframe":{"start":"2023-10-23T17:07:05.637Z","end":"2023-10-23T19:07:05.637Z"},"locale":"","executionTimeMilliseconds":46,"notifications":[{"severity":"INFO","messageFormat":"Command `%s` removes all fields starting with %s. To make sure the fields are not silently removed, you can add a `fields` command before this command. This way it is guaranteed that there are no ingested custom fields with this prefix. Alternatively, you could use the lookup function (`fieldsAdd lookup(...)`) instead to add all fields from the lookup as a nested record. Or, you can define the fields that should be kept from the previous commands (e.g. by using the `fields` command), or define the fields added by the current lookup (using the `fields` parameter instead of a prefix).","syntaxPosition":{"start":{"column":3,"index":83,"line":4},"end":{"column":1,"index":210,"line":6}},"messageFormatSpecifierTypes":["COMMAND_NAME","STRING"],"arguments":["lookup","\"host.\""],"notificationType":"COMMAND_REMOVES_CUSTOM_FIELDS_WITH_PREFIX_OR_USE_LOOKUP_FUNCTION","message":"Command `lookup` removes all fields starting with \"host.\". To make sure the fields are not silently removed, you can add a `fields` command before this command. This way it is guaranteed that there are no ingested custom fields with this prefix. Alternatively, you could use the lookup function (`fieldsAdd lookup(...)`) instead to add all fields from the lookup as a nested record. Or, you can define the fields that should be kept from the previous commands (e.g. by using the `fields` command), or define the fields added by the current lookup (using the `fields` parameter instead of a prefix)."}],"queryId":"28fc9929-097e-43d3-9d65-bfc496fd087d","sampled":false}},"types":[]},"notifications":[{"message":"Command `lookup` removes all fields starting with \"host.\". To make sure the fields are not silently removed, you can add a `fields` command before this command. This way it is guaranteed that there are no ingested custom fields with this prefix. Alternatively, you could use the lookup function (`fieldsAdd lookup(...)`) instead to add all fields from the lookup as a nested record. Or, you can define the fields that should be kept from the previous commands (e.g. by using the `fields` command), or define the fields added by the current lookup (using the `fields` parameter instead of a prefix).","severity":"info"}],"dateTime":"2023-10-23T19:07:05.636Z","input":{"value":"fetch events\n| filter event.kind == \"DAVIS_PROBLEM\"\n| expand affected_entity_ids\n| lookup sourceField:affected_entity_ids, lookupField:id, prefix:\"host.\", [\nfetch dt.entity.host | fields id, name = entity.name\n]\n| filter host.name == \"myhost\"\n| limit 3","timeframe":{"from":"now-2h","to":"now"}}},"visualization":"recordView"},"height":450},{"id":"b88cef84-4ff5-483f-b567-49689141d7cb","type":"markdown","markdown":"### Example 6\nLoad the last state of a given problem."},{"id":"bab76d4b-2d6f-4bcf-8302-956a0c5a5a5a","type":"dql","showTitle":false,"state":{"input":{"value":"fetch events\n| filter event.kind == \"DAVIS_PROBLEM\"\n| filter display_id == \"P-2310175\"\n| sort timestamp desc\n| limit 1","timeframe":{"from":"now-2h","to":"now"}},"state":"success","davis":{"includeLogs":true,"isDavisVisualizationAvailable":true},"visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"absolute"},"categoryOverrides":{}},"singleValue":{"label":"","prefixIcon":"","autoscale":true,"alignment":"center"},"table":{"rowDensity":"condensed","enableLineWrap":true,"enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[["affected_entity_ids"]],"firstVisibleRowIndex":0,"columnWidths":{}}},"result":{"value":{"records":[{"timestamp":"2023-10-23T21:06:57.169000000+02:00","affected_entity_ids":["SERVICE-9E03EFC879357717","SERVICE-41A4F03120E830E8","SERVICE-8BACD834F8B0945E"],"affected_entity_types":["dt.entity.service"],"display_id":"P-2310175","dt.davis.event_ids":["-7777067843940418856_1698084120000","-7222781137289956593_1698083880000","-1394686142519611760_1698083940000","776352788740175970_1698084108402"],"dt.davis.is_duplicate":false,"dt.davis.is_frequent_event":false,"dt.davis.mute.status":"NOT_MUTED","entity_tags":["SLO_SVC:broker-service-*","carts","SLO_SVC:frontendreverseproxy-*","[Kubernetes]namespace:easytrade"],"event.category":"ERROR","event.end":"2023-10-23T20:36:00.000000000+02:00","event.id":"-7222781137289956593_1698083880000V2","event.kind":"DAVIS_PROBLEM","event.name":"Failure rate increase","event.start":"2023-10-23T20:03:00.000000000+02:00","event.status":"CLOSED","event.status_transition":"CLOSED","labels.alerting_profile":["Default"],"maintenance.is_under_maintenance":false,"resolved_problem_duration":"1980000000000","root_cause_entity_id":"SERVICE-9E03EFC879357717"}],"metadata":{"grail":{"canonicalQuery":"fetch events\n| filter event.kind == \"DAVIS_PROBLEM\"\n| filter display_id == \"P-2310175\"\n| sort timestamp, direction:\"descending\"\n| limit 1","timezone":"Europe/Vienna","query":"fetch events\n| filter event.kind == \"DAVIS_PROBLEM\"\n| filter display_id == \"P-2310175\"\n| sort timestamp desc\n| limit 1","scannedRecords":2617,"dqlVersion":"V1_0","scannedBytes":176383,"analysisTimeframe":{"start":"2023-10-23T17:08:58.528Z","end":"2023-10-23T19:08:58.528Z"},"locale":"","executionTimeMilliseconds":20,"notifications":[],"queryId":"16311a34-c6bf-4098-9c70-5333c7307fd0","sampled":false}},"types":[{"mappings":{"timestamp":{"type":"timestamp"},"affected_entity_ids":{"type":"array","types":[{"mappings":{"element":{"type":"string"}},"indexRange":[0,2]}]},"affected_entity_types":{"type":"array","types":[{"mappings":{"element":{"type":"string"}},"indexRange":[0,0]}]},"display_id":{"type":"string"},"dt.davis.event_ids":{"type":"array","types":[{"mappings":{"element":{"type":"string"}},"indexRange":[0,3]}]},"dt.davis.is_duplicate":{"type":"boolean"},"dt.davis.is_frequent_event":{"type":"boolean"},"dt.davis.mute.status":{"type":"string"},"entity_tags":{"type":"array","types":[{"mappings":{"element":{"type":"string"}},"indexRange":[0,3]}]},"event.category":{"type":"string"},"event.end":{"type":"timestamp"},"event.id":{"type":"string"},"event.kind":{"type":"string"},"event.name":{"type":"string"},"event.start":{"type":"timestamp"},"event.status":{"type":"string"},"event.status_transition":{"type":"string"},"labels.alerting_profile":{"type":"array","types":[{"mappings":{"element":{"type":"string"}},"indexRange":[0,0]}]},"maintenance.is_under_maintenance":{"type":"boolean"},"resolved_problem_duration":{"type":"duration"},"root_cause_entity_id":{"type":"string"}},"indexRange":[0,0]}]},"code":200,"notifications":[],"dateTime":"2023-10-23T19:08:58.526Z","input":{"value":"fetch events\n| filter event.kind == \"DAVIS_PROBLEM\"\n| filter display_id == \"P-2310175\"\n| sort timestamp desc\n| limit 1","timeframe":{"from":"now-2h","to":"now"}}},"visualization":"recordView"},"height":450},{"id":"41a611ab-e20e-423d-98ef-b222c151b75a","type":"markdown","markdown":"### Example 7\nLoad all active problems and exclude all those that are marked as duplicates."},{"id":"0dab15f8-64fc-4f5f-8835-123978ff5338","type":"dql","showTitle":false,"state":{"input":{"value":"fetch events\n| filter event.kind == \"DAVIS_PROBLEM\"\n| sort timestamp desc\n| summarize {status = takeFirst(event.status), id = takeFirst(display_id), duplicate = takeFirst(dt.davis.is_duplicate)}, by:{display_id}\n| filter duplicate == false\n| filter status == \"ACTIVE\"","timeframe":{"from":"now-2h","to":"now"}},"state":"success","davis":{"includeLogs":true,"isDavisVisualizationAvailable":true},"visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"absolute"},"categoryOverrides":{}},"singleValue":{"label":"","prefixIcon":"","autoscale":true,"alignment":"center"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"firstVisibleRowIndex":0,"columnWidths":{}}},"result":{"value":{"records":[],"metadata":{"grail":{"canonicalQuery":"fetch events\n| filter event.kind == \"DAVIS_PROBLEM\"\n| sort timestamp, direction:\"descending\"\n| summarize by:{display_id}, {{takeFirst(event.status), alias:status}, {takeFirst(display_id), alias:id}, {takeFirst(dt.davis.is_duplicate), alias:duplicate}}\n| filter duplicate == FALSE\n| filter status == \"ACTIVE\"","timezone":"Europe/Vienna","query":"fetch events\n| filter event.kind == \"DAVIS_PROBLEM\"\n| sort timestamp desc\n| summarize {status = takeFirst(event.status), id = takeFirst(display_id), duplicate = takeFirst(dt.davis.is_duplicate)}, by:{display_id}\n| filter duplicate == false\n| filter status == \"ACTIVE\"","scannedRecords":2631,"dqlVersion":"V1_0","scannedBytes":680550,"analysisTimeframe":{"start":"2023-10-23T17:11:43.851Z","end":"2023-10-23T19:11:43.851Z"},"locale":"","executionTimeMilliseconds":27,"notifications":[],"queryId":"26af4c4e-5eca-451c-ad9f-2225005676f6","sampled":false}},"types":[]},"code":200,"notifications":[],"dateTime":"2023-10-23T19:11:43.850Z","input":{"value":"fetch events\n| filter event.kind == \"DAVIS_PROBLEM\"\n| sort timestamp desc\n| summarize {status = takeFirst(event.status), id = takeFirst(display_id), duplicate = takeFirst(dt.davis.is_duplicate)}, by:{display_id}\n| filter duplicate == false\n| filter status == \"ACTIVE\"","timeframe":{"from":"now-2h","to":"now"}}},"visualization":"recordView"},"height":244},{"id":"d642e3df-c39a-499a-9dfe-067793e04903","type":"markdown","markdown":"### Example 8\nMean time to resolve for problems over time."},{"id":"f30f4271-52d9-46f3-b6a3-af705f217c17","type":"dql","showTitle":false,"state":{"input":{"value":"fetch events, from:now()-7d\n| filter event.kind == \"DAVIS_PROBLEM\"\n| summarize {problem=takeMax(record(timestamp,resolved_problem_duration,event.end,dt.davis.is_duplicate,event.status,maintenance.is_under_maintenance,dt.davis.is_frequent_event)) }, by:{display_id}\n| fieldsFlatten problem\n| filter problem.event.status == \"CLOSED\"\n| filter problem.dt.davis.is_frequent_event == false and problem.dt.davis.is_duplicate == false and problem.maintenance.is_under_maintenance == false\n| makeTimeseries `AVG Problem duration in hours` = avg(toLong(problem.resolved_problem_duration)/3600000000000.0), time:problem.event.end","timeframe":{"from":"now-2h","to":"now"}},"state":"success","davis":{"includeLogs":true,"isDavisVisualizationAvailable":true},"visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"absolute"},"categoryOverrides":{}},"singleValue":{"label":"","prefixIcon":"","autoscale":true,"alignment":"center"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"firstVisibleRowIndex":0,"columnWidths":{}}},"result":{"code":200,"value":{"records":[{"timeframe":{"start":"2023-10-16T19:00:00.000Z","end":"2023-10-23T20:00:00.000Z"},"interval":"3600000000000","AVG Problem duration in hours":[null,0.26666666666666666,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0.55,null,0.26666666666666666,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0.5333333333333333,null,0.26666666666666666,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0.5666666666666667,null,0.26666666666666666,null,null,null,null,null,null,null,null,null,null,null,null,0.8833333333333333,0.1,1.6210591666666667,1.4949869444444444,0.7,null,null,2.9877533333333335,0.9394282407407406,0.5333333333333333,0.6596838888888888,0.25833333333333336,null,null,0.12477,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0.55,null,0.26666666666666666,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0.15,null,null,null,null,null,0.55,null,0.26666666666666666,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,0.15,null,null,null,null,0.55,null]}],"metadata":{"grail":{"canonicalQuery":"fetch events, from:now() - 7d\n| filter event.kind == \"DAVIS_PROBLEM\"\n| summarize by:{display_id}, takeMax(record(timestamp, resolved_problem_duration, event.end, dt.davis.is_duplicate, event.status, maintenance.is_under_maintenance, dt.davis.is_frequent_event)), alias:problem\n| fieldsFlatten problem\n| filter problem.event.status == \"CLOSED\"\n| filter problem.dt.davis.is_frequent_event == FALSE AND problem.dt.davis.is_duplicate == FALSE AND problem.maintenance.is_under_maintenance == FALSE\n| makeTimeseries time:problem.event.end, avg(toLong(problem.resolved_problem_duration) / 3.6E12), alias:`AVG Problem duration in hours`","timezone":"Europe/Vienna","query":"fetch events, from:now()-7d\n| filter event.kind == \"DAVIS_PROBLEM\"\n| summarize {problem=takeMax(record(timestamp,resolved_problem_duration,event.end,dt.davis.is_duplicate,event.status,maintenance.is_under_maintenance,dt.davis.is_frequent_event)) }, by:{display_id}\n| fieldsFlatten problem\n| filter problem.event.status == \"CLOSED\"\n| filter problem.dt.davis.is_frequent_event == false and problem.dt.davis.is_duplicate == false and problem.maintenance.is_under_maintenance == false\n| makeTimeseries `AVG Problem duration in hours` = avg(toLong(problem.resolved_problem_duration)/3600000000000.0), time:problem.event.end","scannedRecords":105831,"dqlVersion":"V1_0","scannedBytes":45671376,"analysisTimeframe":{"start":"2023-10-16T19:11:35.522Z","end":"2023-10-23T19:11:35.522Z"},"locale":"","executionTimeMilliseconds":59,"notifications":[],"queryId":"f94dfbaf-a92c-463b-a93d-20909325a0b1","sampled":false}},"types":[{"mappings":{"timeframe":{"type":"timeframe"},"interval":{"type":"duration"},"AVG Problem duration in hours":{"type":"array","types":[{"mappings":{"element":{"type":"double"}},"indexRange":[0,168]}]}},"indexRange":[0,0]}]},"notifications":[],"dateTime":"2023-10-23T19:11:35.399Z","input":{"value":"fetch events, from:now()-7d\n| filter event.kind == \"DAVIS_PROBLEM\"\n| summarize {problem=takeMax(record(timestamp,resolved_problem_duration,event.end,dt.davis.is_duplicate,event.status,maintenance.is_under_maintenance,dt.davis.is_frequent_event)) }, by:{display_id}\n| fieldsFlatten problem\n| filter problem.event.status == \"CLOSED\"\n| filter problem.dt.davis.is_frequent_event == false and problem.dt.davis.is_duplicate == false and problem.maintenance.is_under_maintenance == false\n| makeTimeseries `AVG Problem duration in hours` = avg(toLong(problem.resolved_problem_duration)/3600000000000.0), time:problem.event.end","timeframe":{"from":"now-2h","to":"now"}}},"visualization":"recordView"},"height":450}]}