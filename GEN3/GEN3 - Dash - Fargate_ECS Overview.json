{"version":15,"variables":[{"key":"ECS_Service_Name","type":"query","visible":true,"input":"timeseries ser=max(cloud.aws.ecs.containerinsights.deploymentCountByAccountIdClusterNameRegionServiceName), by: { servicename, clustername }\n| sort arrayMax(ser) desc\n//| filter contains(clustername,$ECS_Cluster)\n| fields servicename","multiple":true,"defaultValue":["Csr_Apache_Service_CLtest_Ace","Csr_Apache_Service_UStest_Ace"]},{"key":"ECS_Task_Name2","type":"query","visible":false,"input":"timeseries cpuUtilizedByAccountIdClusterNameRegionTaskDefinitionFamily = avg(cloud.aws.ecs.containerinsights.cpuUtilizedByAccountIdClusterNameRegionTaskDefinitionFamily), by: { aws.region, clustername, `dt.entity.cloud:aws:ecs:clustername`, aws.account.id, taskdefinitionfamily, `dt.entity.cloud:aws:account`, `dt.entity.cloud:aws:region` }\n| filter in(clustername,$ECS_Cluster)\n| filter in(taskdefinitionfamily,$ECS_Task_Name)\n| fieldsAdd expression = cpuUtilizedByAccountIdClusterNameRegionTaskDefinitionFamily[] / 100\n| summarize { expression = sum(expression[] ) }, by: { taskdefinitionfamily, interval, timeframe }\n| sort arrayMax(expression) desc\n| fields taskdefinitionfamily","multiple":true},{"key":"ECS_Cluster","type":"query","visible":true,"input":"timeseries max_val=max(cloud.aws.ecs.containerinsights.taskCountByAccountIdClusterNameRegion), by: { clustername }\n| sort arrayMax(max_val) desc\n| fields clustername","multiple":true,"defaultValue":["Personal_Cluster_CLtest_Ace","Personal_Cluster_UStest_Ace","Pow_Cluster_UStest_Ace","Pow_Cluster_CLtest_Ace","Csr_Cluster_CLtest_Ace","Csr_Cluster_UStest_Ace"]},{"key":"ECS_Container_Name","type":"query","visible":true,"input":"fetch dt.entity.host\n| fieldsAdd paasVendorType\n| filter paasVendorType == \"AWS_ECS_FARGATE\"\n| lookup \n\t[\n\t\tfetch dt.entity.process_group_instance\n\t\t| fieldsAdd belongs_to[dt.entity.host]\n        | fieldsAdd runs\n        | fieldsAdd metadata\n        | fieldsAdd isDockerized\n        | fieldsAdd awsNameTag\n        | fieldsAdd pgi_id = id\n\t], sourceField:id, lookupField:belongs_to[dt.entity.host], prefix:\"process.\"\n| fieldsAdd metadata_fields=toString(process.metadata)\n| parse `metadata_fields`, \"\"\"'[' LD{0,10000} '\\\"AWS_ECS_CLUSTER:' LD:aws_ecs_cluster '\\\"' LD{0,10000} ']' EOF\"\"\"\n| parse `metadata_fields`, \"\"\"'[' LD{0,10000} '\\\"AWS_ECS_CONTAINERNAME:' LD:aws_ecs_container_name '\\\"' LD{0,10000} ']' EOF\"\"\"\n| parse `metadata_fields`, \"\"\"'[' LD{0,10000} '\\\"AWS_ECS_FAMILY:' LD:aws_ecs_family '\\\"' LD{0,10000} ']' EOF\"\"\"\n| parse `metadata_fields`, \"\"\"'[' LD{0,10000} '\\\"AWS_ECS_REVISION:' LONG:aws_ecs_revision '\\\"' LD{0,10000} ']' EOF\"\"\"\n| fieldsAdd pg_hyperlink=concat(\"https://cta46234.apps.dynatrace.com/ui/apps/dynatrace.classic.technologies/#processdetails;gtf=-2h;gf=all;id=\",toString(process.pgi_id))\n| parse aws_ecs_cluster, \"LD ':cluster/' LD:aws_ecs_cluster_short EOF\"\n| filter in(aws_ecs_cluster_short,$ECS_Cluster)\n| fields `ECS Container Name`=aws_ecs_container_name\n| sort `ECS Container Name` asc","multiple":false,"defaultValue":"automation_container"},{"key":"ECS_Process_Name","type":"query","visible":false,"input":"fetch dt.entity.host\n| fieldsAdd paasVendorType\n| filter paasVendorType == \"AWS_ECS_FARGATE\"\n| lookup \n\t[\n\t\tfetch dt.entity.process_group_instance\n\t\t| fieldsAdd belongs_to[dt.entity.host]\n        | fieldsAdd runs\n        | fieldsAdd metadata\n        | fieldsAdd isDockerized\n        | fieldsAdd awsNameTag\n        | fieldsAdd pgi_id = id\n\t], sourceField:id, lookupField:belongs_to[dt.entity.host], prefix:\"process.\"\n| fieldsAdd metadata_fields=toString(process.metadata)\n| parse `metadata_fields`, \"\"\"'[' LD{0,10000} '\\\"AWS_ECS_CLUSTER:' LD:aws_ecs_cluster '\\\"' LD{0,10000} ']' EOF\"\"\"\n| parse `metadata_fields`, \"\"\"'[' LD{0,10000} '\\\"AWS_ECS_CONTAINERNAME:' LD:aws_ecs_container_name '\\\"' LD{0,10000} ']' EOF\"\"\"\n| parse `metadata_fields`, \"\"\"'[' LD{0,10000} '\\\"AWS_ECS_FAMILY:' LD:aws_ecs_family '\\\"' LD{0,10000} ']' EOF\"\"\"\n| parse `metadata_fields`, \"\"\"'[' LD{0,10000} '\\\"AWS_ECS_REVISION:' LONG:aws_ecs_revision '\\\"' LD{0,10000} ']' EOF\"\"\"\n| fieldsAdd pg_hyperlink=concat(\"https://cta46234.apps.dynatrace.com/ui/apps/dynatrace.classic.technologies/#processdetails;gtf=-2h;gf=all;id=\",toString(process.pgi_id))\n| parse aws_ecs_cluster, \"LD ':cluster/' LD:aws_ecs_cluster_short EOF\"\n| filter aws_ecs_container_name==$ECS_Container_Name\n| fields `Process Name`=process.entity.name","multiple":false},{"key":"ECS_Task_Name","type":"query","visible":true,"input":"fetch dt.entity.host\n| fieldsAdd paasVendorType\n| filter paasVendorType == \"AWS_ECS_FARGATE\"\n| lookup \n\t[\n\t\tfetch dt.entity.process_group_instance\n\t\t| fieldsAdd belongs_to[dt.entity.host]\n        | fieldsAdd runs\n        | fieldsAdd metadata\n        | fieldsAdd isDockerized\n        | fieldsAdd awsNameTag\n        | fieldsAdd pgi_id = id\n\t], sourceField:id, lookupField:belongs_to[dt.entity.host], prefix:\"process.\"\n| fieldsAdd metadata_fields=toString(process.metadata)\n| parse `metadata_fields`, \"\"\"'[' LD{0,10000} '\\\"AWS_ECS_CLUSTER:' LD:aws_ecs_cluster '\\\"' LD{0,10000} ']' EOF\"\"\"\n| parse `metadata_fields`, \"\"\"'[' LD{0,10000} '\\\"AWS_ECS_CONTAINERNAME:' LD:aws_ecs_container_name '\\\"' LD{0,10000} ']' EOF\"\"\"\n| parse `metadata_fields`, \"\"\"'[' LD{0,10000} '\\\"AWS_ECS_FAMILY:' LD:aws_ecs_family '\\\"' LD{0,10000} ']' EOF\"\"\"\n| parse `metadata_fields`, \"\"\"'[' LD{0,10000} '\\\"AWS_ECS_REVISION:' LONG:aws_ecs_revision '\\\"' LD{0,10000} ']' EOF\"\"\"\n| fieldsAdd pg_hyperlink=concat(\"https://cta46234.apps.dynatrace.com/ui/apps/dynatrace.classic.technologies/#processdetails;gtf=-2h;gf=all;id=\",toString(process.pgi_id))\n| parse aws_ecs_cluster, \"LD ':cluster/' LD:aws_ecs_cluster_short EOF\"\n| filter aws_ecs_container_name==$ECS_Container_Name\n| fields aws_ecs_family\n| sort aws_ecs_family asc","multiple":true,"defaultValue":["Personal_Connect_CLtest_Task_Ace","Csr_Connect_Task_CLtest_Ace"]}],"tiles":{"0":{"type":"data","title":"Container CPU Usage per Task (AWS)","query":"timeseries cpuUtilizedByAccountIdClusterNameRegionTaskDefinitionFamily = avg(cloud.aws.ecs.containerinsights.cpuUtilizedByAccountIdClusterNameRegionTaskDefinitionFamily), by: { aws.region, clustername, `dt.entity.cloud:aws:ecs:clustername`, aws.account.id, taskdefinitionfamily, `dt.entity.cloud:aws:account`, `dt.entity.cloud:aws:region` }\n| fieldsAdd expression = cpuUtilizedByAccountIdClusterNameRegionTaskDefinitionFamily[] / 100\n| summarize { expression = sum(expression[] ) }, by: { taskdefinitionfamily, interval, timeframe }\n| filter in(taskdefinitionfamily,$ECS_Task_Name)\n| sort arrayAvg(expression) desc","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"lineChart","visualizationSettings":{"thresholds":[{"id":"0","title":"","field":"cpuUtilizedByAccountIdClusterNameRegionTaskDefinitionFamily","rules":[{"id":"0","label":"","comparator":"≥","color":"#7dc540"},{"id":"1","label":"","comparator":"≥","color":"#f5d30f"},{"id":"2","label":"","comparator":"≥","color":"#dc172a"}],"isEnabled":true}],"chartSettings":{"seriesOverrides":[],"gapPolicy":"gap","legend":{"hidden":false,"position":"bottom"},"leftYAxisSettings":{"label":""},"categoricalBarChartSettings":{"categoryAxis":"taskdefinitionfamily","categoryAxisLabel":"taskdefinitionfamily","valueAxis":"interval","valueAxisLabel":"interval"},"hiddenLegendFields":["cpuByTask"],"fieldMapping":{"timestamp":"timeframe","leftAxisValues":["expression"],"leftAxisDimensions":["taskdefinitionfamily"]}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"taskdefinitionfamily","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"honeycomb":{"shape":"hexagon","legend":"auto","dataMappings":{"category":"taskdefinitionfamily","value":"taskdefinitionfamily"}},"unitsOverrides":[{"identifier":"expression","unitCategory":"percentage","baseUnit":"percent","displayUnit":null,"decimals":1,"suffix":"","delimiter":false,"added":0,"id":"cpuUtilizedByAccountIdClusterNameRegionTaskDefinitionFamily"}],"histogram":{"dataMappings":[{"valueAxis":"interval","rangeAxis":""}]}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":100,"defaultSamplingRatio":10,"enableSampling":false}},"2":{"type":"data","title":"Running Task Count","query":"timeseries runningTaskCountByAccountIdClusterNameRegionServiceName = avg(cloud.aws.ecs.containerinsights.runningTaskCountByAccountIdClusterNameRegionServiceName), by: { servicename, clustername }\n| sort arrayAvg(runningTaskCountByAccountIdClusterNameRegionServiceName) desc\n| filter in(clustername,$ECS_Cluster)\n| filter in(servicename,$ECS_Service_Name)","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"areaChart","visualizationSettings":{"thresholds":[{"id":"0","title":"","field":"runningTaskCountByAccountIdClusterNameRegionServiceName","rules":[{"id":"0","label":"","comparator":"≥","color":"#7dc540"},{"id":"1","label":"","comparator":"≥","color":"#f5d30f"},{"id":"2","label":"","comparator":"≥","color":"#dc172a"}],"isEnabled":true}],"chartSettings":{"seriesOverrides":[],"gapPolicy":"gap","legend":{"hidden":false},"leftYAxisSettings":{"label":""},"categoricalBarChartSettings":{"categoryAxis":"servicename","categoryAxisLabel":"servicename","valueAxis":"interval","valueAxisLabel":"interval"},"hiddenLegendFields":["clustername"],"fieldMapping":{"timestamp":"timeframe","leftAxisValues":["runningTaskCountByAccountIdClusterNameRegionServiceName"],"leftAxisDimensions":["servicename","clustername"]}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"servicename","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"honeycomb":{"shape":"hexagon","legend":"auto","dataMappings":{"category":"servicename","value":"clustername"}},"unitsOverrides":[{"identifier":"runningTaskCountByAccountIdClusterNameRegionServiceName","unitCategory":"unspecified","baseUnit":"count","displayUnit":"","decimals":0,"suffix":"","delimiter":false,"added":0,"id":"runningTaskCountByAccountIdClusterNameRegionServiceName"}],"histogram":{"dataMappings":[{"valueAxis":"interval","rangeAxis":""}]}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":100,"defaultSamplingRatio":10,"enableSampling":false}},"4":{"type":"data","title":"Process CPU Usage by Task (OneAgent)","query":"timeseries usage = avg(dt.process.cpu.usage), by: { dt.entity.process_group_instance }\n| sort arrayAvg(usage) desc\n| fieldsAdd process_name=entityName(dt.entity.process_group_instance)\n| filter contains(process_name,$ECS_Process_Name)\n//| filter contains(process_name,$ECS_Service_Name)\n//| filter contains(process_name,\"Csr\",caseSensitive:false)//\n//| filter process_name == \"csr-patient-service-clinical-test-DT-POC (Rev. 53)\"","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"lineChart","visualizationSettings":{"thresholds":[{"id":"0","title":"","field":"usage","rules":[{"id":"0","label":"","comparator":"≥","color":"#7dc540"},{"id":"1","label":"","comparator":"≥","color":"#f5d30f"},{"id":"2","label":"","comparator":"≥","color":"#dc172a"}],"isEnabled":true}],"chartSettings":{"seriesOverrides":[],"gapPolicy":"gap","legend":{"hidden":false,"position":"bottom"},"leftYAxisSettings":{"label":""},"categoricalBarChartSettings":{"categoryAxis":"dt.entity.process_group_instance","categoryAxisLabel":"dt.entity.process_group_instance","valueAxis":"interval","valueAxisLabel":"interval"},"hiddenLegendFields":["dt.entity.process_group_instance"],"fieldMapping":{"timestamp":"timeframe","leftAxisValues":["usage"],"leftAxisDimensions":["dt.entity.process_group_instance","process_name"]}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"dt.entity.process_group_instance","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"honeycomb":{"shape":"hexagon","legend":"auto","dataMappings":{"category":"dt.entity.process_group_instance","value":"process_name"}},"unitsOverrides":[{"identifier":"usage","unitCategory":"percentage","baseUnit":"percent","displayUnit":"","decimals":2,"suffix":"","delimiter":false,"added":0,"id":"usage"}],"histogram":{"dataMappings":[{"valueAxis":"interval","rangeAxis":""}]}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":100,"defaultSamplingRatio":10,"enableSampling":false}},"6":{"type":"data","title":"Deployment Count per Service","query":"timeseries max(cloud.aws.ecs.containerinsights.deploymentCountByAccountIdClusterNameRegionServiceName), by: { servicename }\n| filter in(servicename,$ECS_Service_Name)","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"areaChart","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"servicename","categoryAxisLabel":"servicename","valueAxis":"interval","valueAxisLabel":"interval"},"hiddenLegendFields":[],"fieldMapping":{"timestamp":"timeframe","leftAxisValues":["max(cloud.aws.ecs.containerinsights.deploymentCountByAccountIdClusterNameRegionServiceName)"],"leftAxisDimensions":["servicename"]},"legend":{"hidden":false,"position":"bottom"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"servicename","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"honeycomb":{"shape":"hexagon","legend":"auto","dataMappings":{"category":"servicename","value":"servicename"}},"histogram":{"dataMappings":[{"valueAxis":"interval","rangeAxis":""}]}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"8":{"type":"data","title":"Max Task Count per Cluster","query":"timeseries max(cloud.aws.ecs.containerinsights.taskCountByAccountIdClusterNameRegion), by: { clustername }\n| filter in(clustername,$ECS_Cluster)","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"areaChart","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"clustername","categoryAxisLabel":"clustername","valueAxis":"interval","valueAxisLabel":"interval"},"hiddenLegendFields":[],"fieldMapping":{"timestamp":"timeframe","leftAxisValues":["max(cloud.aws.ecs.containerinsights.taskCountByAccountIdClusterNameRegion)"],"leftAxisDimensions":["clustername"]}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"clustername","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"honeycomb":{"shape":"hexagon","legend":"auto","dataMappings":{"category":"clustername","value":"clustername"}},"histogram":{"dataMappings":[{"valueAxis":"interval","rangeAxis":""}]}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"9":{"type":"data","title":"","query":"fetch dt.entity.host\n| fieldsAdd paasVendorType\n| filter paasVendorType == \"AWS_ECS_FARGATE\"\n| lookup \n\t[\n\t\tfetch dt.entity.process_group_instance\n\t\t| fieldsAdd belongs_to[dt.entity.host]\n        | fieldsAdd runs\n        | fieldsAdd metadata\n        | fieldsAdd isDockerized\n        | fieldsAdd awsNameTag\n        | fieldsAdd pgi_id = id\n\t], sourceField:id, lookupField:belongs_to[dt.entity.host], prefix:\"process.\"\n| fieldsAdd metadata_fields=toString(process.metadata)\n| parse `metadata_fields`, \"\"\"'[' LD{0,10000} '\\\"AWS_ECS_CLUSTER:' LD:aws_ecs_cluster '\\\"' LD{0,10000} ']' EOF\"\"\"\n| parse `metadata_fields`, \"\"\"'[' LD{0,10000} '\\\"AWS_ECS_CONTAINERNAME:' LD:aws_ecs_container_name '\\\"' LD{0,10000} ']' EOF\"\"\"\n| parse `metadata_fields`, \"\"\"'[' LD{0,10000} '\\\"AWS_ECS_FAMILY:' LD:aws_ecs_family '\\\"' LD{0,10000} ']' EOF\"\"\"\n| parse `metadata_fields`, \"\"\"'[' LD{0,10000} '\\\"AWS_ECS_REVISION:' LONG:aws_ecs_revision '\\\"' LD{0,10000} ']' EOF\"\"\"\n| fieldsAdd pg_hyperlink=concat(\"https://cta46234.apps.dynatrace.com/ui/apps/dynatrace.classic.technologies/#processdetails;gtf=-2h;gf=all;id=\",toString(process.pgi_id))\n| parse aws_ecs_cluster, \"LD ':cluster/' LD:aws_ecs_cluster_short EOF\"\n// remove Host Name, as it seems unnecessary for PaaS: \n// `Host Name`=entity.name,\n| filter in(aws_ecs_cluster_short,$ECS_Cluster)\n| filter in(aws_ecs_container_name,$ECS_Container_Name)\n| filter in(aws_ecs_family,$ECS_Task_Name)\n| fields `Process Name`=process.entity.name, `ECS Cluster`=aws_ecs_cluster_short, `ECS Container Name`=aws_ecs_container_name,`ECS Task Revision #`=aws_ecs_revision, `ECS Task`=aws_ecs_family, `Link`=pg_hyperlink\n| sort `ECS Container Name`, `ECS Task` asc","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"table","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"Process Name","categoryAxisLabel":"Process Name","valueAxis":"ECS Task Revision #","valueAxisLabel":"ECS Task Revision #"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"Host Name","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{"[\"ECS Cluster\"]":239.70281982421875,"[\"Host Name\"]":249.45989990234375,"[\"Process Name\"]":411.7523193359375,"[\"ECS Task Revision #\"]":111.34786987304688}},"honeycomb":{"shape":"hexagon","legend":"auto","dataMappings":{"category":"Process Name","value":"ECS Cluster"}},"histogram":{"dataMappings":[]}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}}},"layouts":{"0":{"x":0,"y":0,"w":8,"h":5},"2":{"x":8,"y":0,"w":10,"h":5},"4":{"x":0,"y":5,"w":10,"h":7},"6":{"x":28,"y":0,"w":12,"h":5},"8":{"x":18,"y":0,"w":10,"h":5},"9":{"x":10,"y":5,"w":30,"h":7}},"importedWithCode":false,"gridColumnsCount":40}