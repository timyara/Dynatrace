{"version":11,"variables":[{"key":"MgtZone","type":"query","input":"fetch dt.entity.host\n| fields managementZones\n| append [ fetch dt.entity.service\n         | fields managementZones\n         ]\n| append [ fetch dt.entity.application\n         | fields managementZones\n         ]\n| append [ fetch dt.entity.mobile_application\n         | fields managementZones\n         ]         \n| expand managementZones\n| sort managementZones, direction:\"ascending\"\n| summarize distinctManagementZones = collectDistinct(managementZones)\n","multiple":false}],"tiles":{"0":{"type":"data","title":"Process Memory Usage %","query":"timeseries usage=avg(dt.process.memory.usage),by:{dt.entity.process_group_instance}\n| lookup [fetch dt.entity.process_group_instance | fields id, runs, belongs_to, mz=managementZones], sourceField:dt.entity.process_group_instance, lookupField:id\n| filter matchesValue(lookup.mz,$MgtZone)\n| filter isNotNull(lookup.runs)\n| sort arrayAvg(usage) desc\n| limit 20\n| lookup [fetch dt.entity.process_group_instance],sourceField:dt.entity.process_group_instance,lookupField:id,fields:{dt.entity.process_group_instance.name=entity.name}\n| fields timeframe, interval, dt.entity.process_group_instance.name, usage\n| sort usage desc\n","visualization":"lineChart","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"absolute"},"categoryOverrides":{},"legend":{"hidden":true},"leftYAxisSettings":{"min":"auto","max":"auto"},"xAxisScaling":"analyzedTimeframe"},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","autoscale":true,"alignment":"center"},"table":{"rowDensity":"condensed","enableLineWrap":true,"enableSparklines":false,"hiddenColumns":[["lookup.managementZones"],["lookup.id"],["dt.entity.host"]],"lineWrapIds":[["usage"]],"columnWidths":{}},"unitsOverrides":[{"identifier":"dt.host.cpu.usage","unitCategory":"percentage","baseUnit":"percent","displayUnit":null,"decimals":2,"suffix":"","delimiter":true},{"identifier":"dt.host.memory.avail.percent","unitCategory":"percentage","baseUnit":"percent","displayUnit":null,"decimals":2,"suffix":"","delimiter":true},{"identifier":"dt.host.memory.usage","unitCategory":"percentage","baseUnit":"percent","displayUnit":null,"decimals":2,"suffix":"","delimiter":true},{"identifier":"usage","unitCategory":"percentage","baseUnit":"percent","displayUnit":null,"decimals":2,"suffix":"","delimiter":true}]}},"1":{"type":"data","title":"Process CPU Usage %","query":"timeseries usage=avg(dt.process.cpu.usage),by:{dt.entity.process_group_instance}\n| lookup [fetch dt.entity.process_group_instance | fields id, runs, belongs_to, mz=managementZones], sourceField:dt.entity.process_group_instance, lookupField:id\n| filter matchesValue(lookup.mz,$MgtZone)\n| filter isNotNull(lookup.runs)\n| sort arrayAvg(usage) desc\n| limit 20\n| lookup [fetch dt.entity.process_group_instance],sourceField:dt.entity.process_group_instance,lookupField:id,fields:{dt.entity.process_group_instance.name=entity.name}\n| fields timeframe, interval, dt.entity.process_group_instance.name, usage\n| sort usage desc\n","visualization":"lineChart","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"absolute"},"categoryOverrides":{},"legend":{"hidden":true},"xAxisScaling":"auto"},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","autoscale":true,"alignment":"center"},"table":{"rowDensity":"condensed","enableLineWrap":true,"enableSparklines":false,"hiddenColumns":[["lookup.managementZones"],["lookup.id"],["dt.entity.host"]],"lineWrapIds":[["usage"]],"columnWidths":{}},"unitsOverrides":[{"identifier":"dt.host.cpu.usage","unitCategory":"percentage","baseUnit":"percent","displayUnit":null,"decimals":2,"suffix":"","delimiter":true},{"identifier":"dt.host.memory.avail.percent","unitCategory":"percentage","baseUnit":"percent","displayUnit":null,"decimals":2,"suffix":"","delimiter":true},{"identifier":"dt.host.memory.usage","unitCategory":"percentage","baseUnit":"percent","displayUnit":null,"decimals":2,"suffix":"","delimiter":true},{"identifier":"usage","unitCategory":"percentage","baseUnit":"percent","displayUnit":null,"decimals":2,"suffix":"","delimiter":true}]}},"7":{"type":"data","title":"Requests","query":"fetch spans\n| filter span.kind == \"server\"\n| filter isNotNull(http.response.status_code)\n| filterOut endpoint.name == \"Images\" or endpoint.name == \"JavaScript\" or endpoint.name == \"CSS\" \n| lookup [ fetch dt.entity.service \n         | fields name=entity.name, id=id, mz=managementZones], \n           sourceField:dt.entity.service, lookupField:id \n| filter matchesValue(lookup.mz,$MgtZone)\n| fieldsAdd timestamp = start_time\n| makeTimeseries  count = count(), by:{service = lookup.name}\n| sort count desc\n| limit 20","visualization":"barChart","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"absolute"},"categoryOverrides":{},"legend":{"hidden":true}},"singleValue":{"label":"","prefixIcon":"","autoscale":true,"alignment":"center"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"unitsOverrides":[{"identifier":"count","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":0,"suffix":"","delimiter":false,"added":1700683338785}]}},"8":{"type":"data","title":"Requests Errors","query":"fetch spans\n| filter span.kind == \"server\"\n| filter dt.internal.is_failed == true \n| filter isNotNull(http.response.status_code)\n| filter dt.internal.is_failed == true\n| filterOut endpoint.name == \"Images\" or endpoint.name == \"JavaScript\" or endpoint.name == \"CSS\" \n| lookup [ fetch dt.entity.service \n         | fields name=entity.name, id=id, mz=managementZones], \n           sourceField:dt.entity.service, lookupField:id \n| filter matchesValue(lookup.mz,$MgtZone)\n| fieldsAdd ResponseCode = toLong(http.response.status_code)\n//| filter ResponseCode >= 500 and ResponseCode < 600 \n| fieldsAdd timestamp = start_time\n| makeTimeSeries Errors = count(), by:{service = lookup.name}","visualization":"barChart","visualizationSettings":{"thresholds":[{"id":1,"field":"","title":"","isEnabled":true,"rules":[{"id":0,"color":{"Default":"var(--dt-colors-charts-categorical-color-09-default, #649438)"},"comparator":"≥","label":""},{"id":1,"color":{"Default":"var(--dt-colors-charts-categorical-color-14-default, #d56b1a)"},"comparator":"≥","label":""},{"id":2,"color":{"Default":"var(--dt-colors-charts-categorical-color-12-default, #cd3741)"},"comparator":"≥","label":""}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"absolute"},"categoryOverrides":{},"legend":{"hidden":true},"seriesOverrides":[],"categoricalBarChartSettings":{"categoryAxis":"service","categoryAxisLabel":"service","valueAxis":"Errors","valueAxisLabel":"Errors"}},"singleValue":{"label":"","prefixIcon":"","autoscale":true,"alignment":"center"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"unitsOverrides":[{"identifier":"failureRate","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":0,"suffix":"","delimiter":false,"added":1700683084361}]}},"9":{"type":"data","title":"Requests Latency","query":"fetch spans\n| filter span.kind == \"server\"\n| filter isNotNull(http.response.status_code)\n| filterOut endpoint.name == \"Images\" or endpoint.name == \"JavaScript\" or endpoint.name == \"CSS\" \n| lookup [ fetch dt.entity.service \n         | fields name=entity.name, id=id, mz=managementZones], \n           sourceField:dt.entity.service, lookupField:id \n| filter matchesValue(lookup.mz,$MgtZone)\n| fieldsAdd timestamp = start_time\n| makeTimeseries latency = avg((duration)), by:{service = lookup.name}\n| limit 20\n","visualization":"lineChart","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"absolute"},"categoryOverrides":{},"leftYAxisSettings":{"scale":"linear"},"legend":{"hidden":true},"xAxisScaling":"auto","categoricalBarChartSettings":{"categoryAxis":"lookup.name","categoryAxisLabel":"lookup.name","valueAxis":"dt.times.cpu_self_time_in_micros","valueAxisLabel":"dt.times.cpu_self_time_in_micros"},"fieldMapping":{"timestamp":"timestamp","fields":["lookup.name"],"values":["dt.times.cpu_self_time_in_micros"]}},"singleValue":{"label":"","prefixIcon":"","autoscale":true,"alignment":"center"},"table":{"rowDensity":"condensed","enableLineWrap":true,"enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"unitsOverrides":[{"identifier":"latency","unitCategory":"time","baseUnit":"nanosecond","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1700627004186}]}},"11":{"type":"data","title":"Problems List","query":"fetch events\n| filter event.kind == \"DAVIS_PROBLEM\"\n| sort timestamp desc\n\n// Lookup for affected_entity_ids and root_cause_entity_id Start\n| expand affected_entity_ids\n| expand root_cause_entity_id\n\n| lookup [fetch dt.entity.application | fields name=entity.name, id=id, mz=managementZones], sourceField:affected_entity_ids, lookupField:id, prefix:\"lookup.affected.entity.application\"\n| lookup [fetch dt.entity.mobile_application | fields name=entity.name, id=id, mz=managementZones], sourceField:affected_entity_ids, lookupField:id, prefix:\"lookup.affected.entity.mobile\"\n| lookup [fetch dt.entity.custom_application | fields name=entity.name, id=id, mz=managementZones], sourceField:affected_entity_ids, lookupField:id, prefix:\"lookup.affected.entity.custom\"\n| lookup [fetch dt.entity.synthetic_test | fields name=entity.name, id=id, mz=managementZones], sourceField:affected_entity_ids, lookupField:id, prefix:\"lookup.affected.entity.synthetictest\"\n| lookup [fetch dt.entity.http_check | fields name=entity.name, id=id, mz=managementZones], sourceField:affected_entity_ids, lookupField:id, prefix:\"lookup.affected.entity.httpcheck\"\n| lookup [fetch dt.entity.process_group_instance | fields name=entity.name, id=id, mz=managementZones], sourceField:affected_entity_ids, lookupField:id, prefix:\"lookup.affected.entity.pg\"| lookup [fetch dt.entity.service | fields name=entity.name, id=id, mz=managementZones], sourceField:affected_entity_ids, lookupField:id, prefix:\"lookup.affected.entity.service\"\n| lookup [fetch dt.entity.host | fields name=entity.name, id=id, mz=managementZones], sourceField:affected_entity_ids, lookupField:id, prefix:\"lookup.affected.entity.host\"\n| filter matchesValue(lookup.affected.entity.applicationmz,$MgtZone) or\n         matchesValue(lookup.affected.entity.mobilemz,$MgtZone) or\n         matchesValue(lookup.affected.entity.custommz,$MgtZone) or\n         matchesValue(lookup.affected.entity.synthetictestmz,$MgtZone) or\n         matchesValue(lookup.affected.entity.httpcheckmz,$MgtZone) or\n         matchesValue(lookup.affected.entity.pgmz,$MgtZone) or \n         matchesValue(lookup.affected.entity.servicemz,$MgtZone) or\n         matchesValue(lookup.affected.entity.hostmz,$MgtZone)     \n\n\n| lookup [fetch dt.entity.service], sourceField:affected_entity_ids, lookupField: id, prefix:\"lookup.affected.entity.services\"\n| lookup [fetch dt.entity.service], sourceField:root_cause_entity_id, lookupField: id, prefix:\"lookup.rootcause.entity.services\"\n| lookup [fetch dt.entity.process_group_instance], sourceField:affected_entity_ids, lookupField: id, prefix:\"lookup.affected.entity.pgi\"\n| lookup [fetch dt.entity.process_group_instance], sourceField:root_cause_entity_id, lookupField: id, prefix:\"lookup.rootcause.entity.pgi\"\n| lookup [fetch dt.entity.application], sourceField:affected_entity_ids, lookupField: id, prefix:\"lookup.affected.entity.applications\"\n| lookup [fetch dt.entity.application], sourceField:root_cause_entity_id, lookupField: id, prefix:\"lookup.rootcause.entity.applications\"\n| lookup [fetch dt.entity.mobile_application], sourceField:affected_entity_ids, lookupField: id, prefix:\"lookup.affected.entity.mobile\"\n| lookup [fetch dt.entity.mobile_application], sourceField:root_cause_entity_id, lookupField: id, prefix:\"lookup.rootcause.entity.mobile\"\n| lookup [fetch dt.entity.custom_application], sourceField:affected_entity_ids, lookupField: id, prefix:\"lookup.affected.entity.customapplication\"\n| lookup [fetch dt.entity.custom_application], sourceField:root_cause_entity_id, lookupField: id, prefix:\"lookup.rootcause.entity.customapplication\"\n| lookup [fetch dt.entity.cloud_application], sourceField:affected_entity_ids, lookupField: id, prefix:\"lookup.affected.entity.cloudapplication\"\n| lookup [fetch dt.entity.cloud_application], sourceField:root_cause_entity_id, lookupField: id, prefix:\"lookup.rootcause.entity.cloudapplication\"\n| lookup [fetch dt.entity.synthetic_test], sourceField:affected_entity_ids, lookupField: id, prefix:\"lookup.affected.entity.synthetictest\"\n| lookup [fetch dt.entity.synthetic_test], sourceField:root_cause_entity_id, lookupField: id, prefix:\"lookup.rootcause.entity.synthetictest\"\n| lookup [fetch dt.entity.http_check], sourceField:affected_entity_ids, lookupField: id, prefix:\"lookup.affected.entity.httpcheck\"\n| lookup [fetch dt.entity.http_check], sourceField:root_cause_entity_id, lookupField: id, prefix:\"lookup.rootcause.entity.httpcheck\"\n| lookup [fetch dt.entity.kubernetes_cluster], sourceField:affected_entity_ids, lookupField: id, prefix:\"lookup.affected.entity.kubernetescluster\"\n| lookup [fetch dt.entity.kubernetes_cluster], sourceField:root_cause_entity_id, lookupField: id, prefix:\"lookup.rootcause.entity.kubernetescluster\"\n| lookup [fetch dt.entity.host], sourceField:affected_entity_ids, lookupField: id, prefix:\"lookup.affected.entity.hosts\"\n| lookup [fetch dt.entity.host], sourceField:root_cause_entity_id, lookupField: id, prefix:\"lookup.rootcause.entity.hosts\"\n| lookup [fetch dt.entity.custom_device], sourceField:affected_entity_ids, lookupField: id, prefix:\"lookup.affected.entity.customdevices\"\n| lookup [fetch dt.entity.custom_device], sourceField:root_cause_entity_id, lookupField: id, prefix:\"lookup.rootcause.entity.customdevices\"\n| lookup [fetch dt.entity.hypervisor], sourceField:affected_entity_ids, lookupField: id, prefix:\"lookup.affected.entity.hypervisor\"\n| lookup [fetch dt.entity.hypervisor], sourceField:root_cause_entity_id, lookupField: id, prefix:\"lookup.rootcause.entity.hypervisor\"\n| lookup [fetch dt.entity.environment], sourceField:affected_entity_ids, lookupField: id, prefix:\"lookup.affected.entity.environment\"\n// Lookup for affected_entity_ids and root_cause_entity_id End\n\n// Summarzation Start - Group Probem Events by Problem ID\n| summarize {startTime = takeFirst(event.start),\n            endTime = takeFirst(event.end),\n            problemClosedDuration = takeFirst(resolved_problem_duration),\n            status = takeFirst(event.status),\n            event.name = takeFirst(event.name),\n            severityLevel = takeFirst(event.category),\n            affected = takeFirst(affected_entity_ids),\n            rootCause = takeFirst(root_cause_entity_id),\n            dt.davis.is_duplicate = takeFirst(dt.davis.is_duplicate),\n            affectedServices = collectDistinct(lookup.affected.entity.servicesentity.name),\n            affectedPGI = collectDistinct(lookup.affected.entity.pgientity.name),\n            affectedApplications = collectDistinct(lookup.affected.entity.applicationsentity.name),\n            affectedMobile = collectDistinct(lookup.affected.entity.mobileentity.name),\n            affectedCustomApplication = collectDistinct(lookup.affected.entity.customapplicationentity.name),\n            affectedCloudApplication = collectDistinct(lookup.affected.entity.cloudapplicationentity.name),\n            affectedSyntheticTest = collectDistinct(lookup.affected.entity.synthetictestentity.name),\n            affectedHttpCheck = collectDistinct(lookup.affected.entity.httpcheckentity.name),\n            affectedKubernetesCluster = collectDistinct(lookup.affected.entity.kubernetesclusterentity.name),\n            affectedHosts = collectDistinct(lookup.affected.entity.hostsentity.name),\n            affectedCustomDevices = collectDistinct(lookup.affected.entity.customdevicesentity.name),\n            affectedHypervisor = collectDistinct(lookup.affected.entity.hypervisorentity.name),\n            affectedEnvironment = collectDistinct(lookup.affected.entity.environmententity.name),\n            rootCauseServices = collectDistinct(lookup.rootcause.entity.servicesentity.name),\n            rootCausePGI = collectDistinct(lookup.rootcause.entity.pgientity.name),\n            rootCauseApplications = collectDistinct(lookup.rootcause.entity.applicationsentity.name),\n            rootCauseMobile = collectDistinct(lookup.rootcause.entity.mobileentity.name),\n            rootCauseCustomApplication = collectDistinct(lookup.rootcause.entity.customapplicationentity.name),\n            rootCauseSyntheticTest = collectDistinct(lookup.rootcause.entity.synthetictestentity.name),\n            rootCauseHttpCheck = collectDistinct(lookup.rootcause.entity.httpcheckentity.name),\n            rootCauseHosts = collectDistinct(lookup.rootcause.entity.hostsentity.name),\n            rootCauseCustomDevices = collectDistinct(lookup.rootcause.entity.customdevicesentity.name),\n            event.id = takeFirst(event.id)}, \n            by:{display_id}\n| filter `dt.davis.is_duplicate` == false\n| fieldsAdd currentTime = toTimestamp(now())\n| fieldsAdd status = if((status == \"ACTIVE\"),\"OPEN\", \n                else:if((status == \"CLOSED\"), \"CLOSED\"))\n// Summarzation End - Group Probem Events by Problem ID\n\n\n// Final Result Start\n| fields Status = if((status == \"OPEN\"),\"🔴 OPEN\", \n                  else:if((status == \"CLOSED\"),\"🟢 CLOSED\")),\n         Problem = concat(display_id,\" - \",event.name),         \n         Severity = severityLevel,\n         Type = (event.name),\n         AffectedCount = arraySize(arrayRemoveNulls(arrayConcat(affectedApplications,affectedMobile,affectedCustomApplication,affectedCloudApplication,affectedSyntheticTest,affectedHttpCheck,affectedServices,affectedPGI,affectedKubernetesCluster,affectedHosts,affectedHypervisor,affectedCustomDevices,affectedEnvironment))),\n         Affected = arrayRemoveNulls(arrayConcat(affectedApplications,affectedMobile,affectedCustomApplication,affectedCloudApplication,affectedSyntheticTest,affectedHttpCheck,affectedServices,affectedPGI,affectedKubernetesCluster,affectedHosts,affectedHypervisor,affectedCustomDevices,affectedEnvironment)),\n         RootCause = arrayRemoveNulls(arrayConcat(rootCauseServices,rootCauseHosts)),\n         StartTime = startTime,\n         EndTime =  if((status == \"OPEN\"),\"In Progress\", \n                    else:if((status == \"CLOSED\"),endTime)),   \n      //   Duration = if((status == \"CLOSED\"),problemClosedDuration,\n      //              else:if((status == \"OPEN\"), currentTime-startTime)),\n\n         `Duration (min)` = if((status == \"CLOSED\"),problemClosedDuration,\n                   else:if((status == \"OPEN\"), toDuration(currentTime-startTime))),\n      \n         \n         event.id           \n| sort StartTime, direction:\"descending\"\n| sort Status, direction:\"ascending\"\n// Final Result End\n\n","visualization":"table","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"absolute"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"Status","categoryAxisLabel":"Status","valueAxis":"AffectedCount","valueAxisLabel":"AffectedCount"},"fieldMapping":{"timestamp":"StartTime","fields":["Status"],"values":["AffectedCount"]}},"singleValue":{"label":"","prefixIcon":"","autoscale":true,"alignment":"center"},"table":{"rowDensity":"condensed","enableLineWrap":true,"enableSparklines":false,"hiddenColumns":[["AffectedCount"],["Severity"],["Type"]],"lineWrapIds":[["Affected"]],"columnWidths":{"[\"Status\"]":91,"[\"Problem\"]":290,"[\"Affected\"]":321,"[\"RootCause\"]":213,"[\"StartTime\"]":144,"[\"EndTime\"]":211,"[\"Duration (min)\"]":141,"[\"event.id\"]":301,"[\"Severity\"]":null,"[\"Type\"]":null,"[\"AffectedCount\"]":null}}}},"12":{"type":"data","title":"","query":"fetch spans\n| filter span.kind == \"server\"\n| filter isNotNull(http.response.status_code)\n| filterOut endpoint.name == \"Images\" or endpoint.name == \"JavaScript\" or endpoint.name == \"CSS\" \n| lookup [ fetch dt.entity.service \n         | fields name=entity.name, id=id, mz=managementZones], \n           sourceField:dt.entity.service, lookupField:id \n| filter matchesValue(lookup.mz,$MgtZone)\n| summarize count = count()","visualization":"singleValue","visualizationSettings":{"thresholds":[{"id":1,"field":"","title":"","isEnabled":true,"rules":[{"id":0,"color":{"Default":"var(--dt-colors-charts-categorical-color-01-default, #134fc9)"},"comparator":"≥","label":"","value":0},{"id":1,"color":{"Default":"var(--dt-colors-charts-categorical-color-14-default, #d56b1a)"},"comparator":"≥","label":""},{"id":2,"color":{"Default":"var(--dt-colors-charts-categorical-color-12-default, #cd3741)"},"comparator":"≥","label":""}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"absolute"},"categoryOverrides":{}},"singleValue":{"showLabel":true,"label":"Request","prefixIcon":"","autoscale":true,"alignment":"center"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[["dt.davis.event_ids"]],"columnWidths":{},"enableLineWrap":true},"unitsOverrides":[{"identifier":"count","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":0,"suffix":"","delimiter":false,"added":1700683423826}]}},"13":{"type":"data","title":"","query":"fetch spans\n| filter span.kind == \"server\"\n| filter isNotNull(http.response.status_code)\n| filterOut endpoint.name == \"Images\" or endpoint.name == \"JavaScript\" or endpoint.name == \"CSS\" \n| lookup [ fetch dt.entity.service \n         | fields name=entity.name, id=id, mz=managementZones], \n           sourceField:dt.entity.service, lookupField:id \n| filter matchesValue(lookup.mz,$MgtZone)\n| summarize latency = avg(toDouble(duration))\n","visualization":"singleValue","visualizationSettings":{"thresholds":[{"id":1,"field":"","title":"","isEnabled":true,"rules":[{"id":0,"color":"#0D9C29","comparator":"≥","label":"","value":0},{"id":1,"color":{"Default":"var(--dt-colors-charts-categorical-color-14-default, #d56b1a)"},"comparator":"≥","label":""},{"id":2,"color":{"Default":"var(--dt-colors-charts-security-risk-level-critical-default, #8a0012)"},"comparator":"≥","label":"","value":2000000000}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"absolute"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"lookup.name","categoryAxisLabel":"lookup.name","valueAxis":"dt.times.cpu_self_time_in_micros","valueAxisLabel":"dt.times.cpu_self_time_in_micros"},"fieldMapping":{"timestamp":"timestamp","fields":["lookup.name"],"values":["dt.times.cpu_self_time_in_micros"]}},"singleValue":{"showLabel":true,"label":"Request","prefixIcon":"","autoscale":false,"alignment":"center","recordField":"latency","sparklineSettings":{"isVisible":false}},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[["dt.davis.event_ids"]],"columnWidths":{},"enableLineWrap":true},"unitsOverrides":[{"identifier":"latency","unitCategory":"time","baseUnit":"nanosecond","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1700627482300}]}},"15":{"type":"data","title":"","query":"fetch spans\n| filter span.kind == \"server\"\n| filter dt.internal.is_failed == true \n| filter isNotNull(http.response.status_code)\n| filterOut endpoint.name == \"Images\" or endpoint.name == \"JavaScript\" or endpoint.name == \"CSS\" \n| lookup [ fetch dt.entity.service \n         | fields name=entity.name, id=id, mz=managementZones], \n           sourceField:dt.entity.service, lookupField:id \n| filter matchesValue(lookup.mz,$MgtZone)\n| fieldsAdd ResponseCode = toLong(http.response.status_code)\n| filter ResponseCode >= 500 and ResponseCode < 600 \n| summarize Errors = count()","visualization":"singleValue","visualizationSettings":{"thresholds":[{"id":1,"field":"","title":"","isEnabled":true,"rules":[{"id":0,"color":"#0D9C29","comparator":"≥","label":"","value":0},{"id":1,"color":{"Default":"var(--dt-colors-charts-categorical-color-14-default, #d56b1a)"},"comparator":"≥","label":""},{"id":2,"color":{"Default":"var(--dt-colors-charts-security-risk-level-critical-default, #8a0012)"},"comparator":"≥","label":"","value":2}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"absolute"},"categoryOverrides":{}},"singleValue":{"label":"HTTP 5xx","prefixIcon":"","autoscale":true,"alignment":"center","showLabel":true},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"unitsOverrides":[{"identifier":"failureRate","unitCategory":"percentage","baseUnit":"percent","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1700685486722}]}},"19":{"type":"data","title":"","query":"fetch events\n| filter event.type == \"PGI_CRASHED_INFO\"\n| lookup [fetch dt.entity.process_group_instance | fields id, runs, belongs_to, mz=managementZones], sourceField:dt.entity.process_group_instance, lookupField:id\n| filter matchesValue(lookup.mz,$MgtZone)\n| filter isNotNull(lookup.runs)\n| summarize `Process Crashes` = count()//, by:{dt.entity.process_group_instance.name}\n\n\n","davis":{"enabled":false},"visualization":"singleValue","visualizationSettings":{"thresholds":[{"id":1,"field":"","title":"","isEnabled":true,"rules":[{"id":0,"color":"#0D9C29","comparator":"≥","label":"","value":0},{"id":1,"color":{"Default":"var(--dt-colors-charts-categorical-color-14-default, #d56b1a)"},"comparator":"≥","label":""},{"id":2,"color":{"Default":"var(--dt-colors-charts-security-risk-level-critical-default, #8a0012)"},"comparator":"≥","label":"","value":1}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"dt.entity.process_group_instance.name","categoryAxisLabel":"dt.entity.process_group_instance.name","valueAxis":"Process Crashes","valueAxisLabel":"Process Crashes"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","autoscale":true,"alignment":"center"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"unitsOverrides":[{"identifier":"Process Crashes","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":0,"suffix":"","delimiter":false,"added":1700712789842}]}},"20":{"type":"data","title":"","query":"fetch events\n| filter event.kind == \"DAVIS_PROBLEM\"\n| sort timestamp desc\n| expand affected_entity_ids\n| lookup [fetch dt.entity.application | fields name=entity.name, id=id, mz=managementZones], sourceField:affected_entity_ids, lookupField:id, prefix:\"lookup.affected.entity.application\"\n| lookup [fetch dt.entity.mobile_application | fields name=entity.name, id=id, mz=managementZones], sourceField:affected_entity_ids, lookupField:id, prefix:\"lookup.affected.entity.mobile\"\n| lookup [fetch dt.entity.custom_application | fields name=entity.name, id=id, mz=managementZones], sourceField:affected_entity_ids, lookupField:id, prefix:\"lookup.affected.entity.custom\"\n| lookup [fetch dt.entity.synthetic_test | fields name=entity.name, id=id, mz=managementZones], sourceField:affected_entity_ids, lookupField:id, prefix:\"lookup.affected.entity.synthetictest\"\n| lookup [fetch dt.entity.http_check | fields name=entity.name, id=id, mz=managementZones], sourceField:affected_entity_ids, lookupField:id, prefix:\"lookup.affected.entity.httpcheck\"\n| lookup [fetch dt.entity.process_group | fields name=entity.name, id=id, mz=managementZones], sourceField:affected_entity_ids, lookupField:id, prefix:\"lookup.affected.entity.pg\"\n| lookup [fetch dt.entity.service | fields name=entity.name, id=id, mz=managementZones], sourceField:affected_entity_ids, lookupField:id, prefix:\"lookup.affected.entity.service\"\n| lookup [fetch dt.entity.host | fields name=entity.name, id=id, mz=managementZones], sourceField:affected_entity_ids, lookupField:id, prefix:\"lookup.affected.entity.host\"\n| filter matchesValue(lookup.affected.entity.applicationmz,$MgtZone) or\n         matchesValue(lookup.affected.entity.mobilemz,$MgtZone) or\n         matchesValue(lookup.affected.entity.custommz,$MgtZone) or\n         matchesValue(lookup.affected.entity.synthetictestmz,$MgtZone) or\n         matchesValue(lookup.affected.entity.httpcheckmz,$MgtZone) or\n         matchesValue(lookup.affected.entity.pgmz,$MgtZone) or \n         matchesValue(lookup.affected.entity.servicemz,$MgtZone) or\n         matchesValue(lookup.affected.entity.hostmz,$MgtZone)     \n\n// First Summarzation Start - Group Probem Events by Problem ID\n| summarize {startTime = takeFirst(event.start),\n            endTime = takeFirst(event.end),\n            problemClosedDuration = takeFirst(resolved_problem_duration),\n            status = takeFirst(event.status),\n            event.name = takeFirst(event.name),\n            severityLevel = takeFirst(event.category),\n            affected = takeFirst(affected_entity_ids),\n            rootCause = takeFirst(root_cause_entity_id),\n            dt.davis.is_duplicate = takeFirst(dt.davis.is_duplicate),\n            event.id = takeFirst(event.id)}, \n            by:{display_id}\n| filter `dt.davis.is_duplicate` == false\n// First Summarzation End - Group Probem Events by Problem ID\n\n// Dashboard Fitlers Start\n\n// Dashboard Fitlers End\n\n// Second Summarzation Start - Summarize Open Problems Count\n| summarize Open = countIf(status == \"ACTIVE\"), Closed = countIf(status == \"CLOSED\"), Total = count()\n| fieldsAdd State = if(Open > 0, \"🔴\", else: \"🟢\")\n| fields Problems = concat(State, \" \", Open, \"/\", Total)\n// Second Summarzation End - Summarize Open Problems Count","visualization":"singleValue","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"absolute"},"categoryOverrides":{}},"singleValue":{"showLabel":true,"label":"Problems","prefixIcon":"","autoscale":false,"alignment":"center"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[["dt.davis.event_ids"]],"columnWidths":{},"enableLineWrap":true}}},"21":{"type":"markdown","title":"","content":"### 🚦 Status"},"22":{"type":"markdown","title":"","content":"### 📊  Traffic"},"23":{"type":"markdown","title":"","content":"## 📈 Latency"},"24":{"type":"markdown","title":"","content":"### ❌ Errors"},"26":{"type":"data","title":"Process Crashes","query":"fetch events\n| filter event.type == \"PGI_CRASHED_INFO\"\n| lookup [fetch dt.entity.process_group_instance | fields id, runs, belongs_to, mz=managementZones], sourceField:dt.entity.process_group_instance, lookupField:id\n| filter matchesValue(lookup.mz,$MgtZone)\n| filter isNotNull(lookup.runs)\n| maketimeSeries crashes = count(), default: 0, by:{dt.entity.process_group_instance.name}\n","davis":{"enabled":false},"visualization":"barChart","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"legend":{"hidden":true},"categoricalBarChartSettings":{"categoryAxis":"dt.davis.impact_level","categoryAxisLabel":"dt.davis.impact_level","valueAxis":"mike","valueAxisLabel":"mike"},"fieldMapping":{"timestamp":"timestamp","fields":["dt.davis.impact_level"],"values":["mike"]}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","autoscale":true,"alignment":"center"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"unitsOverrides":[{"identifier":"crashes","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":0,"suffix":"","delimiter":false,"added":1700791178886}]}},"27":{"type":"data","title":"","query":"fetch spans\n| filter span.kind == \"client\"\n| filter isNotNull(db.name)\n| lookup [ fetch dt.entity.service \n         | fields name=entity.name, id=id,mz=managementZones], \n           sourceField:dt.entity.service, lookupField:id\n| filter matchesValue(lookup.mz,$MgtZone)\n| filter isNotNull(db.statement)\n| summarize count = count()\n             ","visualization":"singleValue","visualizationSettings":{"thresholds":[{"id":1,"field":"","title":"","isEnabled":true,"rules":[{"id":0,"color":{"Default":"var(--dt-colors-charts-categorical-color-01-default, #134fc9)"},"comparator":"≥","label":"","value":0},{"id":1,"color":{"Default":"var(--dt-colors-charts-categorical-color-14-default, #d56b1a)"},"comparator":"≥","label":""},{"id":2,"color":{"Default":"var(--dt-colors-charts-categorical-color-12-default, #cd3741)"},"comparator":"≥","label":""}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"absolute"},"categoryOverrides":{}},"singleValue":{"showLabel":true,"label":"Query","prefixIcon":"","autoscale":true,"alignment":"center"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[["dt.davis.event_ids"]],"columnWidths":{},"enableLineWrap":true},"unitsOverrides":[{"identifier":"count","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":0,"suffix":"","delimiter":false,"added":1700683423826}]}},"28":{"type":"data","title":"Database - Most Frequent Queries","query":"fetch spans\n| filter span.kind == \"client\"\n| filter db.name != \"\"\n| lookup [ fetch dt.entity.service \n         | fields name=entity.name, id=id,mz=managementZones], \n           sourceField:dt.entity.service, lookupField:id\n| filter matchesValue(lookup.mz,$MgtZone)\n| filter isNotNull(db.statement)\n| summarize {Count = count(), \n             Latency = median(duration)}, \n             by: {Database = db.name, Query = db.statement}\n\n| append [ fetch spans\n| filter span.kind == \"client\"\n| filter isNotNull(span.events)\n| filter db.name != \"\"\n| filter isNotNull(db.statement)\n| lookup [ fetch dt.entity.service \n         | fields name=entity.name, id=id, mz=managementZones], \n           sourceField:dt.entity.service, lookupField:id\n         | filter matchesValue(lookup.mz,$MgtZone)\n         | fieldsAdd eventname = span.events[0][span_event.name]\n         | filter eventname == \"exception\"\n         | summarize {Errors = count()}, \n            by:{Database = db.name, Query = db.statement}\n]\n\n| summarize  Count = max(Count), \n             Latency = avg(Latency),\n             Errors = max(Errors),\n             by:{Database, Query}\n| fieldsAdd Errors = if(isNull(Errors), 0, else:Errors)\n| sort Count desc\n| limit 10\n","davis":{"enabled":false},"visualization":"table","visualizationSettings":{"thresholds":[{"id":1,"field":"Errors","title":"","isEnabled":true,"rules":[{"id":0,"color":"#0D9C29","comparator":"≥","label":"","value":0},{"id":1,"color":{"Default":"var(--dt-colors-charts-categorical-color-14-default, #d56b1a)"},"comparator":"≥","label":""},{"id":2,"color":{"Default":"var(--dt-colors-charts-security-risk-level-critical-default, #8a0012)"},"comparator":"≥","label":"","value":1}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"database","categoryAxisLabel":"database","valueAxis":"count","valueAxisLabel":"count"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","autoscale":true,"alignment":"center"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[["query"],["Query"]],"columnWidths":{}}}},"29":{"type":"data","title":"Database - Slowest Queries","query":"fetch spans\n| filter span.kind == \"client\"\n| filter db.name != \"\"\n| lookup [ fetch dt.entity.service \n         | fields name=entity.name, id=id, mz=managementZones], \n           sourceField:dt.entity.service, lookupField:id\n| filter matchesValue(lookup.mz,$MgtZone)\n| filter isNotNull(db.statement)\n| summarize {Latency = median(duration), \n             Count = count()}, \n             by: {Database = db.name, Query = db.statement}\n\n| append [ fetch spans\n| filter span.kind == \"client\"\n| filter isNotNull(span.events)\n| filter db.name != \"\"\n| filter isNotNull(db.statement)\n| lookup [ fetch dt.entity.service \n         | fields name=entity.name, id=id, mz=managementZones], \n           sourceField:dt.entity.service, lookupField:id\n         | filter matchesValue(lookup.mz,$MgtZone)\n         | fieldsAdd eventname = span.events[0][span_event.name]\n         | filter eventname == \"exception\"\n         | summarize {Errors = count()}, \n            by:{Database = db.name, Query = db.statement}\n]\n\n| summarize  Latency = avg(Latency),\n             Count = max(Count),\n             Errors = max(Errors),\n             by:{Database, Query}\n| fieldsAdd Errors = if(isNull(Errors), 0, else:Errors)\n| sort Latency desc\n| limit 10","davis":{"enabled":false},"visualization":"table","visualizationSettings":{"thresholds":[{"id":1,"field":"Errors","title":"","isEnabled":true,"rules":[{"id":0,"color":"#0D9C29","comparator":"≥","label":"","value":0},{"id":1,"color":{"Default":"var(--dt-colors-charts-categorical-color-14-default, #d56b1a)"},"comparator":"≥","label":""},{"id":2,"color":{"Default":"var(--dt-colors-charts-categorical-color-12-default, #cd3741)"},"comparator":"≥","label":"","value":1}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"database","categoryAxisLabel":"database","valueAxis":"count","valueAxisLabel":"count"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","autoscale":true,"alignment":"center"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[["query"],["Query"]],"columnWidths":{}}}},"30":{"type":"data","title":"Top Requests","query":"fetch spans\n| filter span.kind == \"server\"\n| filter isNotNull(http.response.status_code)\n| filterOut endpoint.name == \"Images\" or endpoint.name == \"JavaScript\" or endpoint.name == \"CSS\" \n| lookup [ fetch dt.entity.service \n         | fields name=entity.name, id=id, mz=managementZones], \n           sourceField:dt.entity.service, lookupField:id \n| filter matchesValue(lookup.mz,$MgtZone)\n| summarize {Count = count(),Latency = median(duration), \n             Errors = countIf(dt.internal.is_failed == true)}, \n             by: {Service = lookup.name,Request = url.path}\n//| fieldsAdd Service_Request = concat(Service, \" - \", Request)\n//| fields Service_Request, Count,Latency,  Errors\n| sort Count desc\n| limit 10","davis":{"enabled":false},"visualization":"table","visualizationSettings":{"thresholds":[{"id":1,"field":"Errors","title":"","isEnabled":true,"rules":[{"id":0,"color":"#0D9C29","comparator":"≥","label":"","value":0},{"id":1,"color":{"Default":"var(--dt-colors-charts-categorical-color-14-default, #d56b1a)"},"comparator":"≥","label":""},{"id":2,"color":{"Default":"var(--dt-colors-charts-categorical-themed-fireplace-color-01-default, #ae132d)"},"comparator":"≥","label":"","value":1}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"Service","categoryAxisLabel":"Service","valueAxis":"Count","valueAxisLabel":"Count"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","autoscale":true,"alignment":"center"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{"[\"service\"]":163,"[\"url\"]":434,"[\"cnt\"]":69}}}},"31":{"type":"data","title":"Top Slowest Requests","query":"fetch spans\n| filter span.kind == \"server\"\n| filter isNotNull(http.response.status_code)\n| filterOut endpoint.name == \"Images\" or endpoint.name == \"JavaScript\" or endpoint.name == \"CSS\" \n| lookup [ fetch dt.entity.service \n         | fields name=entity.name, id=id, mz=managementZones], \n           sourceField:dt.entity.service, lookupField:id \n| filter matchesValue(lookup.mz,$MgtZone)\n| summarize {Latency = median(duration),\n             Count = count(),\n             Errors = countIf(dt.internal.is_failed == true)}, \n             by: {Service = lookup.name,Request = url.path}\n//| fieldsAdd Service_Request = concat(Service, \" - \", Request)\n//| fields Service_Request, Count,Latency,  Errors\n| sort Latency desc\n| limit 10","davis":{"enabled":false},"visualization":"table","visualizationSettings":{"thresholds":[{"id":1,"field":"Errors","title":"","isEnabled":true,"rules":[{"id":0,"color":"#0D9C29","comparator":"≥","label":"","value":0},{"id":1,"color":{"Default":"var(--dt-colors-charts-categorical-color-14-default, #d56b1a)"},"comparator":"≥","label":""},{"id":2,"color":{"Default":"var(--dt-colors-charts-categorical-themed-fireplace-color-01-default, #ae132d)"},"comparator":"≥","label":"","value":1}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"Service","categoryAxisLabel":"Service","valueAxis":"Count","valueAxisLabel":"Count"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","autoscale":true,"alignment":"center"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{"[\"service\"]":163,"[\"url\"]":434,"[\"cnt\"]":69,"[\"Service\"]":204,"[\"Request\"]":381,"[\"Latency\"]":127,"[\"Count\"]":86,"[\"Errors\"]":88}}}},"32":{"type":"data","title":"Top Requests with Errors","query":"fetch spans\n| filter span.kind == \"server\"\n| filter dt.internal.is_failed == true \n| filter isNotNull(http.response.status_code)\n| filterOut endpoint.name == \"Images\" or endpoint.name == \"JavaScript\" or endpoint.name == \"CSS\" \n| lookup [ fetch dt.entity.service \n         | fields name=entity.name, id=id, mz=managementZones], \n           sourceField:dt.entity.service, lookupField:id \n| filter matchesValue(lookup.mz,$MgtZone)\n| fieldsAdd ResponseCode = toLong(http.response.status_code)\n//| filter ResponseCode == 400 or (ResponseCode >= 500 and ResponseCode < 600) \n| summarize {Errors = count(),\n             Latency = median(duration)}, \n             by: {Service = lookup.name,Request = url.path, ResponseCode}\n| fields Service, Request, Errors, ResponseCode, Latency\n| sort Errors desc\n| limit 10","davis":{"enabled":false},"visualization":"table","visualizationSettings":{"thresholds":[{"id":1,"field":"Errors","title":"","isEnabled":true,"rules":[{"id":0,"color":"#0D9C29","comparator":"≥","label":"","value":0},{"id":1,"color":{"Default":"var(--dt-colors-charts-categorical-color-14-default, #d56b1a)"},"comparator":"≥","label":""},{"id":2,"color":{"Default":"var(--dt-colors-charts-categorical-themed-fireplace-color-01-default, #ae132d)"},"comparator":"≥","label":"","value":1}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"Service","categoryAxisLabel":"Service","valueAxis":"Errors","valueAxisLabel":"Errors"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","autoscale":true,"alignment":"center"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{"[\"service\"]":163,"[\"url\"]":434,"[\"cnt\"]":69,"[\"Service\"]":225.53125,"[\"Request\"]":273.25,"[\"Errors\"]":87.875,"[\"ResponseCode\"]":140.53125,"[\"Latency\"]":97.921875}}}},"33":{"type":"data","title":"Database - Errors","query":"fetch spans\n| filter span.kind == \"client\"\n| filter isNotNull(span.events)\n| filter db.name != \"\"\n| filter isNotNull(db.statement)\n| lookup [ fetch dt.entity.service \n         | fields name=entity.name, id=id, mz=managementZones], \n           sourceField:dt.entity.service, lookupField:id\n| filter matchesValue(lookup.mz,$MgtZone)\n| fieldsAdd exception = span.events[0][exception.message]\n| fieldsAdd eventname = span.events[0][span_event.name]\n| filter eventname == \"exception\"\n| summarize {ExceptionMessage = collectDistinct(exception),\n             Errors = count()}, \n            by:{Database = db.name, Query = db.statement}\n| sort Errors desc\n| limit 10\n\n","davis":{"enabled":false},"visualization":"table","visualizationSettings":{"thresholds":[{"id":1,"field":"Errors","title":"","isEnabled":true,"rules":[{"id":0,"color":"#0D9C29","comparator":"≥","label":"","value":0},{"id":1,"color":{"Default":"var(--dt-colors-charts-categorical-color-14-default, #d56b1a)"},"comparator":"≥","label":""},{"id":2,"color":{"Default":"var(--dt-colors-charts-security-risk-level-critical-default, #8a0012)"},"comparator":"≥","label":"","value":1}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"database","categoryAxisLabel":"database","valueAxis":"errors","valueAxisLabel":"errors"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","autoscale":true,"alignment":"center"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[["database"],["errors"],["exceptionMessage"],["query"],["Query"]],"columnWidths":{"[\"service\"]":163,"[\"url\"]":434,"[\"cnt\"]":69}},"unitsOverrides":[]}},"34":{"type":"markdown","title":"","content":"### 🔎 Service Analysis - Requests, Latency and Errors by Request"},"35":{"type":"markdown","title":"","content":"### 🔎 Database Analysis - Queries, Latency and Errors by Query"},"36":{"type":"data","title":"","query":"fetch spans\n| filter span.kind == \"client\"\n| filter isNotNull(span.events)\n| filter db.name != \"\"\n| filter isNotNull(db.statement)\n| lookup [ fetch dt.entity.service \n         | fields name=entity.name, id=id, mz=managementZones], \n           sourceField:dt.entity.service, lookupField:id\n| filter matchesValue(lookup.mz,$MgtZone)\n| fieldsAdd eventname = span.events[0][span_event.name]\n| filter eventname == \"exception\"\n| summarize Errors = count()","visualization":"singleValue","visualizationSettings":{"thresholds":[{"id":1,"field":"","title":"","isEnabled":true,"rules":[{"id":0,"color":"#0D9C29","comparator":"≥","label":"","value":0},{"id":1,"color":{"Default":"var(--dt-colors-charts-categorical-color-14-default, #d56b1a)"},"comparator":"≥","label":""},{"id":2,"color":{"Default":"var(--dt-colors-charts-security-risk-level-critical-default, #8a0012)"},"comparator":"≥","label":"","value":1}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"absolute"},"categoryOverrides":{}},"singleValue":{"label":"Query","prefixIcon":"","autoscale":true,"alignment":"center","showLabel":true},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"unitsOverrides":[{"identifier":"failureRate","unitCategory":"percentage","baseUnit":"percent","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1700685486722}]}},"37":{"type":"data","title":"Queries","query":"fetch spans\n| filter span.kind == \"client\"\n| filter db.name != \"\"\n| lookup [ fetch dt.entity.service \n         | fields name=entity.name, id=id,mz=managementZones], \n           sourceField:dt.entity.service, lookupField:id\n| filter matchesValue(lookup.mz,$MgtZone)\n| filter isNotNull(db.statement)\n| fieldsAdd timestamp = start_time\n| makeTimeSeries Count = count(), by:{database = db.name}\n","davis":{"enabled":false},"visualization":"barChart","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"legend":{"hidden":true}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","autoscale":true,"alignment":"center"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}}}},"38":{"type":"data","title":"Query Latency","query":"fetch spans\n| filter span.kind == \"client\"\n| filter db.name != \"\"\n| lookup [ fetch dt.entity.service \n         | fields name=entity.name, id=id,mz=managementZones], \n           sourceField:dt.entity.service, lookupField:id\n| filter matchesValue(lookup.mz,$MgtZone)\n| filter isNotNull(db.statement)\n| fieldsAdd timestamp = start_time\n| makeTimeSeries Latency = avg(toDouble(duration)), by:{database = db.name}\n","davis":{"enabled":false},"visualization":"lineChart","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"legend":{"hidden":true}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","autoscale":true,"alignment":"center"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"unitsOverrides":[{"identifier":"Latency","unitCategory":"time","baseUnit":"nanosecond","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1700874748938}]}},"39":{"type":"data","title":"Query Errors","query":"fetch spans\n| filter span.kind == \"client\"\n| filter isNotNull(span.events)\n| filter db.name != \"\"\n| filter isNotNull(db.statement)\n| lookup [ fetch dt.entity.service \n         | fields name=entity.name, id=id, mz=managementZones], \n           sourceField:dt.entity.service, lookupField:id\n| filter matchesValue(lookup.mz,$MgtZone)\n| fieldsAdd eventname = span.events[0][span_event.name]\n| filter eventname == \"exception\"\n| fieldsAdd timestamp = start_time\n| makeTimeSeries errors = count(), by:{database = db.name}\n","davis":{"enabled":false},"visualization":"barChart","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"legend":{"hidden":true},"categoricalBarChartSettings":{"categoryAxis":"database","categoryAxisLabel":"database","valueAxis":"errors","valueAxisLabel":"errors"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","autoscale":true,"alignment":"center"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}}}},"40":{"type":"data","title":"","query":"fetch spans\n| filter span.kind == \"client\"\n| filter db.name != \"\"\n| lookup [ fetch dt.entity.service \n         | fields name=entity.name, id=id,mz=managementZones], \n           sourceField:dt.entity.service, lookupField:id\n| filter matchesValue(lookup.mz,$MgtZone)\n| filter isNotNull(db.statement)\n| Summarize Latency = avg(toDouble(duration))\n","visualization":"singleValue","visualizationSettings":{"thresholds":[{"id":1,"field":"","title":"","isEnabled":true,"rules":[{"id":0,"color":"#0D9C29","comparator":"≥","label":"","value":0},{"id":1,"color":{"Default":"var(--dt-colors-charts-categorical-color-14-default, #d56b1a)"},"comparator":"≥","label":""},{"id":2,"color":{"Default":"var(--dt-colors-charts-security-risk-level-critical-default, #8a0012)"},"comparator":"≥","label":"","value":2000000000}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"absolute"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"lookup.name","categoryAxisLabel":"lookup.name","valueAxis":"dt.times.cpu_self_time_in_micros","valueAxisLabel":"dt.times.cpu_self_time_in_micros"},"fieldMapping":{"timestamp":"timestamp","fields":["lookup.name"],"values":["dt.times.cpu_self_time_in_micros"]}},"singleValue":{"showLabel":true,"label":"Query","prefixIcon":"","autoscale":false,"alignment":"center","recordField":"Latency","sparklineSettings":{"isVisible":false}},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[["dt.davis.event_ids"]],"columnWidths":{},"enableLineWrap":true},"unitsOverrides":[{"identifier":"Latency","unitCategory":"time","baseUnit":"nanosecond","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1700627482300}]}},"41":{"type":"data","title":"","query":"fetch spans\n| filter span.kind == \"server\"\n| filter isNotNull(http.response.status_code)\n| filterOut endpoint.name == \"Images\" or endpoint.name == \"JavaScript\" or endpoint.name == \"CSS\" \n| lookup [ fetch dt.entity.service \n         | fields name=entity.name, id=id, mz=managementZones], \n           sourceField:dt.entity.service, lookupField:id \n| filter matchesValue(lookup.mz,$MgtZone)\n| summarize  FailureRate = avg(if(dt.internal.is_failed == true, 100, else: 0))\n| fieldsAdd SLO = toDouble(100-FailureRate)\n| fieldsRemove FailureRate","visualization":"singleValue","visualizationSettings":{"thresholds":[{"id":1,"field":"","title":"","isEnabled":true,"rules":[{"id":0,"color":"#0D9C29","comparator":"≥","label":"","value":98},{"id":1,"color":{"Default":"var(--dt-colors-charts-categorical-color-14-default, #d56b1a)"},"comparator":"≥","label":"","value":97},{"id":2,"color":{"Default":"var(--dt-colors-charts-security-risk-level-critical-default, #8a0012)"},"comparator":">","label":"","value":0}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"absolute"},"categoryOverrides":{}},"singleValue":{"label":"Error","prefixIcon":"","autoscale":true,"alignment":"center","showLabel":true,"recordField":"SLO"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"unitsOverrides":[{"identifier":"SLO","unitCategory":"percentage","baseUnit":"percent","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1700685486722}]}},"42":{"type":"markdown","title":"","content":"### ✅ SLO Status"},"43":{"type":"data","title":"","query":"fetch spans\n| filter span.kind == \"server\"\n| filter isNotNull(http.response.status_code)\n| filterOut endpoint.name == \"Images\" or endpoint.name == \"JavaScript\" or endpoint.name == \"CSS\" \n| lookup [ fetch dt.entity.service \n         | fields name=entity.name, id=id, mz=managementZones], \n           sourceField:dt.entity.service, lookupField:id \n| filter matchesValue(lookup.mz,$MgtZone)\n| fieldsAdd SlowRequest = if(toLong(duration) > 2000000000, \"Slow\", else:\"Fast\")\n| summarize SlowRequestRate = avg(if(SlowRequest == \"Slow\", 100, else: 0))\n| fieldsAdd SLO = toDouble(100-SlowRequestRate)\n| fieldsRemove SlowRequestRate","visualization":"singleValue","visualizationSettings":{"thresholds":[{"id":1,"field":"","title":"","isEnabled":true,"rules":[{"id":0,"color":"#0D9C29","comparator":"≥","label":"","value":98},{"id":1,"color":{"Default":"var(--dt-colors-charts-categorical-color-14-default, #d56b1a)"},"comparator":"≥","label":"","value":97},{"id":2,"color":{"Default":"var(--dt-colors-charts-security-risk-level-critical-default, #8a0012)"},"comparator":">","label":"","value":0}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"absolute"},"categoryOverrides":{}},"singleValue":{"label":"Latency","prefixIcon":"","autoscale":true,"alignment":"center","showLabel":true,"recordField":"SLO"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"unitsOverrides":[{"identifier":"SLO","unitCategory":"percentage","baseUnit":"percent","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1700685486722}]}},"44":{"type":"data","title":"","query":"fetch spans\n| filter span.kind == \"server\"\n| filter dt.internal.is_failed == true \n| filter isNotNull(http.response.status_code)\n| filterOut endpoint.name == \"Images\" or endpoint.name == \"JavaScript\" or endpoint.name == \"CSS\" \n| lookup [ fetch dt.entity.service \n         | fields name=entity.name, id=id, mz=managementZones], \n           sourceField:dt.entity.service, lookupField:id \n| filter matchesValue(lookup.mz,$MgtZone)\n| fieldsAdd ResponseCode = toLong(http.response.status_code)\n| filter ResponseCode >= 400 and ResponseCode < 500 \n| summarize Errors = count()","visualization":"singleValue","visualizationSettings":{"thresholds":[{"id":1,"field":"","title":"","isEnabled":true,"rules":[{"id":0,"color":"#0D9C29","comparator":"≥","label":"","value":0},{"id":1,"color":{"Default":"var(--dt-colors-charts-categorical-color-14-default, #d56b1a)"},"comparator":"≥","label":"","value":1},{"id":2,"color":{"Default":"var(--dt-colors-charts-categorical-themed-fireplace-color-01-default, #ae132d)"},"comparator":"≥","label":""}]}],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"absolute"},"categoryOverrides":{}},"singleValue":{"label":"HTTP 4xx","prefixIcon":"","autoscale":true,"alignment":"center","showLabel":true},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"unitsOverrides":[{"identifier":"failureRate","unitCategory":"percentage","baseUnit":"percent","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1700685486722}]}},"45":{"type":"data","title":"Top Exceptions","query":"fetch spans\n| filterOut endpoint.name == \"Images\" or endpoint.name == \"JavaScript\" or endpoint.name == \"CSS\" \n| filter isNotNull(thread.id)\n| lookup [ fetch dt.entity.service \n         | fields name=entity.name, id=id, mz=managementZones], \n           sourceField:dt.entity.service, lookupField:id \n| filter matchesValue(lookup.mz,$MgtZone)\n| fieldsAdd exception.message = span.events[0][exception.message]\n| fieldsAdd exception.class = span.events[0][exception.type]\n| fieldsAdd eventname = span.events[0][span_event.name]\n| filter eventname == \"exception\"\n| lookup [ fetch dt.entity.process_group_instance     \n         | fields name=entity.name, id=id],\n           sourceField:dt.entity.process_group_instance, lookupField:id, prefix:\"lookup.pgi_\"\n| summarize Count = count(), by:{Service = lookup.name, Process = lookup.pgi_name, Class = exception.class, Message = exception.message}\n| sort Count desc\n| fields Service, Process, Class, Message, Count\n| limit 10\n","davis":{"enabled":false},"visualization":"table","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"class","categoryAxisLabel":"class","valueAxis":"count","valueAxisLabel":"count"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","autoscale":true,"alignment":"center"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[["Message"]],"columnWidths":{}}}},"46":{"type":"markdown","title":"","content":"### 🔎 Exception Analysis"},"47":{"type":"markdown","title":"","content":"### 🔎 Log Error Analysis"},"48":{"type":"data","title":"","query":"fetch logs\n| filter matchesValue(loglevel, \"ERROR\") or matchesValue(loglevel, \"SEVERE\") or matchesPhrase(content, \"ERROR\",caseSensitive:false)\n| filterOut isNull(trace_id)\n| lookup [ fetch dt.entity.process_group_instance     \n         | fields name=entity.name, id=id, mz=managementZones, si = runs[dt.entity.service_instance]],\n           sourceField:dt.entity.process_group_instance, lookupField:id, prefix:\"lookup.pgi_\"\n| filter matchesValue(lookup.pgi_mz,$MgtZone)\n| filterOut isNull(lookup.pgi_si)\n| expand lookup.pgi_si\n| lookup [ fetch dt.entity.service_instance\n         | fields name=entity.name, id=id, servicename =instance_of[dt.entity.service]], \n           sourceField:lookup.pgi_si, lookupField:id ,prefix:\"lookup.si_\"\n| lookup [ fetch dt.entity.service\n         | fields name=entity.name, id=id], \n           sourceField:lookup.si_servicename, lookupField:id ,prefix:\"lookup.service_\"\n| filterOut matchesPhrase(lookup.service_name, \"background\") or matchesPhrase(lookup.service_name, \"health\",caseSensitive:false) \n| fields timestamp, Service = lookup.service_name, Process = dt.process.name, trace_id, content\n//| fields timestamp, Process = dt.process.name, trace_id, content\n| sort timestamp desc\n| limit 100","davis":{"enabled":false},"visualization":"table","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","autoscale":true,"alignment":"center"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[["content"]],"columnWidths":{}}}}},"layouts":{"0":{"x":8,"y":11,"w":8,"h":4},"1":{"x":0,"y":11,"w":8,"h":4},"7":{"x":0,"y":3,"w":8,"h":4},"8":{"x":16,"y":3,"w":8,"h":4},"9":{"x":8,"y":3,"w":8,"h":4},"11":{"x":0,"y":15,"w":24,"h":5},"12":{"x":8,"y":1,"w":2,"h":2},"13":{"x":12,"y":1,"w":2,"h":2},"15":{"x":16,"y":1,"w":2,"h":2},"19":{"x":22,"y":1,"w":2,"h":2},"20":{"x":0,"y":1,"w":4,"h":2},"21":{"x":0,"y":0,"w":3,"h":1},"22":{"x":8,"y":0,"w":4,"h":1},"23":{"x":12,"y":0,"w":4,"h":1},"24":{"x":16,"y":0,"w":8,"h":1},"26":{"x":16,"y":11,"w":8,"h":4},"27":{"x":10,"y":1,"w":2,"h":2},"28":{"x":12,"y":21,"w":12,"h":7},"29":{"x":12,"y":28,"w":12,"h":7},"30":{"x":0,"y":21,"w":12,"h":7},"31":{"x":0,"y":28,"w":12,"h":7},"32":{"x":0,"y":35,"w":12,"h":7},"33":{"x":12,"y":35,"w":12,"h":7},"34":{"x":0,"y":20,"w":12,"h":1},"35":{"x":12,"y":20,"w":12,"h":1},"36":{"x":20,"y":1,"w":2,"h":2},"37":{"x":0,"y":7,"w":8,"h":4},"38":{"x":8,"y":7,"w":8,"h":4},"39":{"x":16,"y":7,"w":8,"h":4},"40":{"x":14,"y":1,"w":2,"h":2},"41":{"x":4,"y":1,"w":2,"h":2},"42":{"x":4,"y":0,"w":4,"h":1},"43":{"x":6,"y":1,"w":2,"h":2},"44":{"x":18,"y":1,"w":2,"h":2},"45":{"x":0,"y":43,"w":24,"h":6},"46":{"x":0,"y":42,"w":24,"h":1},"47":{"x":0,"y":49,"w":24,"h":1},"48":{"x":0,"y":50,"w":24,"h":6}}}